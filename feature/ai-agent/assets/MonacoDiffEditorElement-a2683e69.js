import{j}from"./createTheme-d4c6d141.js";import{R as T,e as v}from"./toggleHighContrast-952d1b59.js";import{r as l}from"./index-37ba2b57.js";import{f as F,L as G}from"./graphql-samples-79dbe107.js";import{e as W}from"./index-6b7f7c95.js";import{S as K,s as z,n as P,p as B,u as _,a as Q,b as H,r as J}from"./utils-afdb0ff1.js";import{b as X}from"./router-3bda5a86.js";import{u as Y}from"./useEffectOnce-12abbac4.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-9c75dc50.js";import"./iframe-7d79a74b.js";import"../sb-preview/runtime.js";import"./_commonjsHelpers-de833af9.js";import"./files-221a97f0.js";import"./apihub-builder.es-a0fb97bd.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./strings-8f296fda.js";import"./dialogTitleClasses-c8d9dbc5.js";import"./clsx.m-6cf3b989.js";import"./ClassNameGenerator-bd600f10.js";import"./useThemeProps-90078124.js";import"./useTheme-0ad13214.js";import"./Modal-9f2c2b11.js";import"./utils-0c060528.js";import"./inheritsLoose-5494d9cc.js";import"./index-4da2af8c.js";import"./TransitionGroupContext-f40e0036.js";import"./useEnhancedEffect-9d60ea74.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-03d1c82d.js";import"./createChainedFunction-0bab83cf.js";import"./Portal-fc00eb8c.js";import"./isHostComponent-73d6e646.js";import"./Paper-dca8f967.js";import"./useId-f6e37502.js";import"./DialogTitle-cd1b99ce.js";import"./Typography-d1555f73.js";import"./extendSxProp-acc1143e.js";import"./DialogContent-fd001b96.js";import"./DialogContentText-f02e7458.js";import"./Button-7fbb2719.js";import"./ButtonBase-1b5192e9.js";import"./emotion-react.browser.esm-f969ea94.js";import"./assertThisInitialized-081f9914.js";import"./createSvgIcon-473ccb66.js";import"./constants-e3f42350.js";import"./index-2374ef69.js";function Z(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class $ extends K{constructor(e,t){super(),this.client=e,this.setOptions(t),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.client.defaultMutationOptions(e),z(t,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this})}onUnsubscribe(){if(!this.listeners.length){var e;(e=this.currentMutation)==null||e.removeObserver(this)}}onMutationUpdate(e){this.updateResult();const t={listeners:!0};e.type==="success"?t.onSuccess=!0:e.type==="error"&&(t.onError=!0),this.notify(t)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(e,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof e<"u"?e:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const e=this.currentMutation?this.currentMutation.state:Z(),t={...e,isLoading:e.status==="loading",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=t}notify(e){P.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(e.onSuccess){var t,u,c,r;(t=(u=this.mutateOptions).onSuccess)==null||t.call(u,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(c=(r=this.mutateOptions).onSettled)==null||c.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(e.onError){var n,i,o,a;(n=(i=this.mutateOptions).onError)==null||n.call(i,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(o=(a=this.mutateOptions).onSettled)==null||o.call(a,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}e.listeners&&this.listeners.forEach(p=>{p(this.currentResult)})})}}function ee(s,e,t){const u=B(s,e,t),c=_({context:u.context}),[r]=l.useState(()=>new $(c,u));l.useEffect(()=>{r.setOptions(u)},[r,u]);const n=Q(l.useCallback(o=>r.subscribe(P.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),i=l.useCallback((o,a)=>{r.mutate(o,a).catch(te)},[r]);if(n.error&&H(r.options.useErrorBoundary,[n.error]))throw n.error;return{...n,mutate:i,mutateAsync:n.mutate}}function te(){}const re="/stub/api/v1";function ne(){const s=_(),{mutate:e,isLoading:t}=ee({mutationFn:u=>ie(u),onSuccess:async()=>{await s.invalidateQueries({queryKey:["ai-enhanced-document-raw-content"]})}});return{mutate:e,isReverting:t}}function ie(s){const{packageId:e,version:t,slug:u,content:c}=s,r=encodeURIComponent(e),n=encodeURIComponent(t),i=encodeURIComponent(u),a=X("/packages/:packageId/versions/:versionId/enhancedFiles/:documentId/raw",{packageId:r,versionId:n,documentId:i});return J(a,{method:"PUT",body:c},{basePath:re})}const g={add:"add",remove:"remove",change:"change"};function E(s){const{packageId:e,versionId:t,documentId:u}=W(),{mutate:c,isReverting:r}=ne(),n=l.useRef([]),i=l.useRef(null),o=l.useRef(null);l.useEffect(()=>{if(!s.current)return;const a=s.current,p=a.getModifiedEditor(),d=a.getModel();if(!d)return;const m=d.modified.uri.toString();if(i.current===m)return;i.current=m,o.current&&o.current.dispose(),n.current.forEach(h=>{p.removeGlyphMarginWidget(h)}),n.current=[];const L=()=>{n.current.forEach(b=>{p.removeGlyphMarginWidget(b)});const h=a.getLineChanges();if(!h)return;const S=[];h.forEach(b=>{const{modifiedStartLineNumber:D,modifiedEndLineNumber:M}=b,V=q(b);for(let f=D;f<=M;f++){const y=document.createElement("button");y.textContent="â†’",y.style.cssText="cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;",y.onclick=I=>{var x,k;I.preventDefault(),I.stopPropagation();const N=(x=a.getModel())==null?void 0:x.original.getValue(),w=(k=a.getModel())==null?void 0:k.modified.getValue();if(N&&w){const A=oe(N,w,b);c({packageId:e??"",version:t??"",slug:u??"",content:A})}};let R;V===g.add?(R=new T(f,1,M,1),f+=M-f+1):R=new T(f,1,f,1);const C={getId:()=>`line-control-${f}`,getDomNode:()=>y,getPosition:()=>({lane:v.GlyphMarginLane.Right,zIndex:10,range:R})};p.addGlyphMarginWidget(C),S.push(C)}}),n.current=S};return L(),o.current=a.onDidUpdateDiff(()=>{L()}),()=>{var h;(h=o.current)==null||h.dispose()}},[s])}function oe(s,e,t){const u=s.split(`
`),c=e.split(`
`),r=q(t);if(r===g.remove){const n=u.slice(t.originalStartLineNumber-1,t.originalEndLineNumber),i=[...c];return i.splice(t.modifiedStartLineNumber-1,0,...n),i.join(`
`)}if(r===g.change){const n=u.slice(t.originalStartLineNumber-1,t.originalEndLineNumber),i=[...c];return i.splice(t.modifiedStartLineNumber-1,n.length,...n),i.join(`
`)}return r===g.add?c.filter((i,o)=>o<t.modifiedStartLineNumber-1||o>t.modifiedEndLineNumber-1).join(`
`):""}function q(s){const{originalStartLineNumber:e,originalEndLineNumber:t,modifiedStartLineNumber:u,modifiedEndLineNumber:c}=s,r=c-u,n=t-e;return r===n?g.change:r>n?g.add:g.remove}try{E.displayName="useAddLineControls",E.__docgenInfo={description:"",displayName:"useAddLineControls",props:{}}}catch{}function se(s){const{before:e,after:t,type:u,language:c=G,selectedUri:r}=s,n=l.useRef(null),i=l.useRef();return Y(()=>(v.defineTheme("custom",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#FFFFFF"}}),i.current=v.createDiffEditor(n.current,{minimap:{enabled:!0},hover:{above:!1},automaticLayout:!0,readOnly:!0,wordWrap:"on",glyphMargin:!0,theme:"custom"}),()=>{var o,a;try{(o=i.current)==null||o.setModel(null)}catch{}(a=i.current)==null||a.dispose(),i.current=void 0})),l.useEffect(()=>{var p;const o=v.createModel(e,c),a=v.createModel(t,c);return(p=i.current)==null||p.setModel({original:o,modified:a}),()=>{const{current:d}=i,m=d==null?void 0:d.getModel();if(d&&m&&m.original===o&&m.modified===a)try{d.setModel(null)}catch{}o.dispose(),a.dispose()}},[i,e,t,c,u]),E(i),l.useEffect(()=>{var a,p;const o=(p=(a=i.current)==null?void 0:a.getModel())==null?void 0:p.modified.getValue();if(r&&o){const d=F(o,r);if(d){const m=d==null?void 0:d.range.start.line;ae(i.current,m+1)}}},[r]),n}function ae(s,e){s.revealLineNearTop(e,v.ScrollType.Smooth),s.setPosition({lineNumber:e,column:0}),s.focus()}const O=l.memo(({before:s,after:e,type:t,language:u,selectedUri:c})=>{const r=se({before:s,after:e,type:t,language:u,selectedUri:c});return j("div",{ref:r,style:{height:"100%"}})});try{O.displayName="MonacoDiffEditorElement",O.__docgenInfo={description:"",displayName:"MonacoDiffEditorElement",props:{before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"string"}},after:{defaultValue:null,description:"",name:"after",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"graphql"'},{value:'"openapi-3-1"'},{value:'"openapi-3-0"'},{value:'"openapi-2-0"'},{value:'"openapi"'},{value:'"asyncapi-2"'},{value:'"json-schema"'},{value:'"markdown"'},{value:'"unknown"'},{value:'"graphql-schema"'},{value:'"graphapi"'},{value:'"introspection"'},{value:'"protobuf-3"'}]}},language:{defaultValue:null,description:"",name:"language",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"graphql"'},{value:'"markdown"'},{value:'"yaml"'},{value:'"json"'},{value:'"proto"'}]}},selectedUri:{defaultValue:null,description:"",name:"selectedUri",required:!1,type:{name:"`/${string}`"}}}}}catch{}export{O as default};
//# sourceMappingURL=MonacoDiffEditorElement-a2683e69.js.map
