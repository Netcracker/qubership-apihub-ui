import{j as z}from"./createTheme-d4c6d141.js";import{R as S,e as y}from"./toggleHighContrast-b6b15a17.js";import{r as g}from"./index-37ba2b57.js";import{f as K,L as B}from"./graphql-samples-79dbe107.js";import{e as Q}from"./index-6b7f7c95.js";import{S as H,s as J,n as P,p as X,u as V,a as Y,b as Z,r as $}from"./utils-afdb0ff1.js";import{b as ee}from"./router-3bda5a86.js";import{u as te}from"./useEffectOnce-12abbac4.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-9c75dc50.js";import"./iframe-6837ad69.js";import"../sb-preview/runtime.js";import"./_commonjsHelpers-de833af9.js";import"./files-221a97f0.js";import"./apihub-builder.es-a0fb97bd.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./strings-8f296fda.js";import"./dialogTitleClasses-c8d9dbc5.js";import"./clsx.m-6cf3b989.js";import"./ClassNameGenerator-bd600f10.js";import"./useThemeProps-90078124.js";import"./useTheme-0ad13214.js";import"./Modal-9f2c2b11.js";import"./utils-0c060528.js";import"./inheritsLoose-5494d9cc.js";import"./index-4da2af8c.js";import"./TransitionGroupContext-f40e0036.js";import"./useEnhancedEffect-9d60ea74.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-03d1c82d.js";import"./createChainedFunction-0bab83cf.js";import"./Portal-fc00eb8c.js";import"./isHostComponent-73d6e646.js";import"./Paper-dca8f967.js";import"./useId-f6e37502.js";import"./DialogTitle-cd1b99ce.js";import"./Typography-d1555f73.js";import"./extendSxProp-acc1143e.js";import"./DialogContent-fd001b96.js";import"./DialogContentText-f02e7458.js";import"./Button-7fbb2719.js";import"./ButtonBase-1b5192e9.js";import"./emotion-react.browser.esm-f969ea94.js";import"./assertThisInitialized-081f9914.js";import"./createSvgIcon-473ccb66.js";import"./constants-e3f42350.js";import"./index-2374ef69.js";function ne(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class re extends H{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.client.defaultMutationOptions(t),J(e,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this})}onUnsubscribe(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:ne(),e={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=e}notify(t){P.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var e,s,i,r;(e=(s=this.mutateOptions).onSuccess)==null||e.call(s,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(i=(r=this.mutateOptions).onSettled)==null||i.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var o,n,u,c;(o=(n=this.mutateOptions).onError)==null||o.call(n,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(u=(c=this.mutateOptions).onSettled)==null||u.call(c,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(l=>{l(this.currentResult)})})}}function ie(a,t,e){const s=X(a,t,e),i=V({context:s.context}),[r]=g.useState(()=>new re(i,s));g.useEffect(()=>{r.setOptions(s)},[r,s]);const o=Y(g.useCallback(u=>r.subscribe(P.batchCalls(u)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),n=g.useCallback((u,c)=>{r.mutate(u,c).catch(oe)},[r]);if(o.error&&Z(r.options.useErrorBoundary,[o.error]))throw o.error;return{...o,mutate:n,mutateAsync:o.mutate}}function oe(){}const se="/stub/api/v1";function ae(){const a=V(),{mutate:t,isLoading:e}=ie({mutationFn:s=>ue(s),onSuccess:async()=>{await a.invalidateQueries({queryKey:["ai-enhanced-document-raw-content"]})}});return{mutate:t,isReverting:e}}function ue(a){const{packageId:t,version:e,slug:s,content:i}=a,r=encodeURIComponent(t),o=encodeURIComponent(e),n=encodeURIComponent(s),c=ee("/packages/:packageId/versions/:versionId/enhancedFiles/:documentId/raw",{packageId:r,versionId:o,documentId:n});return $(c,{method:"PUT",body:i},{basePath:se})}const M={add:"add",remove:"remove",change:"change"};function ce(a,t,e){const{packageId:s,versionId:i,documentId:r}=Q(),{mutate:o}=ae(),n=g.useRef([]),u=g.useRef(null),c=g.useRef(null);g.useEffect(()=>{if(!a.current)return;const l=a.current,v=l.getModifiedEditor(),m=l.getModel();if(!m)return;const p=m.modified.uri.toString();if(u.current===p)return;u.current=p,c.current&&c.current.dispose(),n.current.forEach(d=>{v.removeGlyphMarginWidget(d)}),n.current=[];const f=()=>{n.current.forEach(R=>{v.removeGlyphMarginWidget(R)});const d=l.getLineChanges();if(!d)return;const w=[];d.forEach(R=>{const{modifiedStartLineNumber:_,modifiedEndLineNumber:D}=R,j=F(R);for(let b=_;b<=D;b++){const L=document.createElement("button");L.textContent="â†’",L.style.cssText="cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;",L.onclick=I=>{var k,q,A;I.preventDefault(),I.stopPropagation();try{const E=v.getVisibleRanges(),G=(k=E==null?void 0:E[0])==null?void 0:k.startLineNumber,W=v.getScrollTop();e==null||e({scrollTop:W,firstVisibleLine:G})}catch{}const N=(q=l.getModel())==null?void 0:q.original.getValue(),x=(A=l.getModel())==null?void 0:A.modified.getValue();if(N&&x){const E=le(N,x,R);o({packageId:s??"",version:i??"",slug:r??"",content:E}),t(R)}};let T;j===M.add?(T=new S(b,1,D,1),b+=D-b+1):T=new S(b,1,b,1);const C={getId:()=>`line-control-${b}`,getDomNode:()=>L,getPosition:()=>({lane:y.GlyphMarginLane.Right,zIndex:10,range:T})};v.addGlyphMarginWidget(C),w.push(C)}}),n.current=w};return f(),c.current=l.onDidUpdateDiff(()=>{f()}),()=>{var d;(d=c.current)==null||d.dispose()}},[r,a,s,o,t,e,i])}function le(a,t,e){const s=a.split(`
`),i=t.split(`
`),r=F(e);if(r===M.remove){const o=s.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),n=[...i];return n.splice(e.modifiedStartLineNumber-1,0,...o),n.join(`
`)}if(r===M.change){const o=s.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),n=[...i];return n.splice(e.modifiedStartLineNumber-1,o.length,...o),n.join(`
`)}return r===M.add?i.filter((n,u)=>u<e.modifiedStartLineNumber-1||u>e.modifiedEndLineNumber-1).join(`
`):""}function F(a){const{originalStartLineNumber:t,originalEndLineNumber:e,modifiedStartLineNumber:s,modifiedEndLineNumber:i}=a,r=i-s,o=e-t;return r===o?M.change:r>o?M.add:M.remove}function de(a){const{before:t,after:e,type:s,language:i=B,selectedUri:r}=a,o=g.useRef(null),n=g.useRef(),[u,c]=g.useState(void 0),[l,v]=g.useState(void 0);return te(()=>(y.defineTheme("custom",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#FFFFFF"}}),n.current=y.createDiffEditor(o.current,{minimap:{enabled:!0},hover:{above:!1},automaticLayout:!0,readOnly:!0,wordWrap:"on",glyphMargin:!0,theme:"custom"}),()=>{var m,p;try{(m=n.current)==null||m.setModel(null)}catch{}(p=n.current)==null||p.dispose(),n.current=void 0})),g.useEffect(()=>{var h;const m=y.createModel(t,i),p=y.createModel(e,i);if((h=n.current)==null||h.setModel({original:m,modified:p}),u)if(l)pe(n.current,l);else{const f=u.modifiedStartLineNumber;f!==void 0&&U(n.current,f)}return()=>{const{current:f}=n,d=f==null?void 0:f.getModel();if(f&&d&&d.original===m&&d.modified===p)try{f.setModel(null)}catch{}m.dispose(),p.dispose()}},[n,t,e,i,s,u,l]),ce(n,c,v),g.useEffect(()=>{var p,h;const m=(h=(p=n.current)==null?void 0:p.getModel())==null?void 0:h.modified.getValue();if(m&&r){const f=K(m,r),d=f==null?void 0:f.range.start.line;d!==void 0&&U(n.current,d+1)}},[r]),o}function U(a,t){const e=a.getModifiedEditor(),s=300,i=Date.now()+s;let r=0;const o=30,n=()=>{const p=Date.now();if(p-r<o)return;r=p;const h=new S(t,1,t,1);e.revealRangeNearTop(h,y.ScrollType.Smooth),e.setSelection(h),e.focus()};e.getModel()&&requestAnimationFrame(()=>{n()});const c=[],l=()=>{c.forEach(p=>{try{p.dispose()}catch{}})};c.push(a.onDidUpdateDiff(()=>{n(),Date.now()>i&&l()})),c.push(e.onDidLayoutChange(()=>{n(),Date.now()>i&&l()})),c.push(e.onDidScrollChange(()=>{n(),Date.now()>i&&l()})),setTimeout(()=>{n(),Date.now()>i&&l()},50);let v=3;const m=()=>{const h=e.getVisibleRanges().some(d=>d.startLineNumber<=t&&d.endLineNumber>=t),f=e.getScrollTop()>0||t===1;h||f||v<=0||(v-=1,setTimeout(()=>{const d=new S(t,1,t,1);e.revealRangeNearTop(d,y.ScrollType.Smooth),requestAnimationFrame(m)},60))};requestAnimationFrame(m)}function pe(a,t){const e=a.getModifiedEditor(),s=300,i=Date.now()+s;let r=0;const o=30,n=()=>{const l=Date.now();l-r<o||(r=l,e.setScrollTop(t.scrollTop,y.ScrollType.Immediate))},u=[],c=()=>{u.forEach(l=>{try{l.dispose()}catch{}})};requestAnimationFrame(n),u.push(a.onDidUpdateDiff(()=>{n(),Date.now()>i&&c()})),u.push(e.onDidLayoutChange(()=>{n(),Date.now()>i&&c()})),u.push(e.onDidScrollChange(()=>{n(),Date.now()>i&&c()})),setTimeout(()=>{n(),Date.now()>i&&c()},50)}const O=g.memo(({before:a,after:t,type:e,language:s,selectedUri:i})=>{const r=de({before:a,after:t,type:e,language:s,selectedUri:i});return z("div",{ref:r,style:{height:"100%"}})});try{O.displayName="MonacoDiffEditorElement",O.__docgenInfo={description:"",displayName:"MonacoDiffEditorElement",props:{before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"string"}},after:{defaultValue:null,description:"",name:"after",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"graphql"'},{value:'"openapi-3-1"'},{value:'"openapi-3-0"'},{value:'"openapi-2-0"'},{value:'"openapi"'},{value:'"asyncapi-2"'},{value:'"json-schema"'},{value:'"markdown"'},{value:'"unknown"'},{value:'"graphql-schema"'},{value:'"graphapi"'},{value:'"introspection"'},{value:'"protobuf-3"'}]}},language:{defaultValue:null,description:"",name:"language",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"graphql"'},{value:'"markdown"'},{value:'"yaml"'},{value:'"json"'},{value:'"proto"'}]}},selectedUri:{defaultValue:null,description:"",name:"selectedUri",required:!1,type:{name:"`/${string}`"}}}}}catch{}export{O as default};
//# sourceMappingURL=MonacoDiffEditorElement-f28cb0a4.js.map
