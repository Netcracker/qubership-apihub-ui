import{j as O}from"./createTheme-d4c6d141.js";import{R as S,e as h}from"./toggleHighContrast-1079d864.js";import{r as b}from"./index-37ba2b57.js";import{f as z,L as H}from"./graphql-samples-79dbe107.js";import{e as $}from"./index-6b7f7c95.js";import{u as B}from"./useEffectOnce-12abbac4.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-9c75dc50.js";import"./iframe-642d7dc2.js";import"../sb-preview/runtime.js";import"./_commonjsHelpers-de833af9.js";import"./files-221a97f0.js";import"./apihub-builder.es-a0fb97bd.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./strings-8f296fda.js";import"./dialogTitleClasses-c8d9dbc5.js";import"./clsx.m-6cf3b989.js";import"./ClassNameGenerator-bd600f10.js";import"./useThemeProps-90078124.js";import"./useTheme-0ad13214.js";import"./Modal-9f2c2b11.js";import"./utils-0c060528.js";import"./inheritsLoose-5494d9cc.js";import"./index-4da2af8c.js";import"./TransitionGroupContext-f40e0036.js";import"./useEnhancedEffect-9d60ea74.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-03d1c82d.js";import"./createChainedFunction-0bab83cf.js";import"./Portal-fc00eb8c.js";import"./isHostComponent-73d6e646.js";import"./Paper-dca8f967.js";import"./useId-f6e37502.js";import"./DialogTitle-cd1b99ce.js";import"./Typography-d1555f73.js";import"./extendSxProp-acc1143e.js";import"./DialogContent-fd001b96.js";import"./DialogContentText-f02e7458.js";import"./Button-7fbb2719.js";import"./ButtonBase-1b5192e9.js";import"./emotion-react.browser.esm-f969ea94.js";import"./assertThisInitialized-081f9914.js";import"./createSvgIcon-473ccb66.js";import"./router-3bda5a86.js";const T={add:"add",remove:"remove",change:"change"};function X(l,i,e,c){const{packageId:o,versionId:a,documentId:d}=$(),t=b.useRef([]),n=b.useRef(null),u=b.useRef(null);b.useEffect(()=>{if(!l.current)return;const r=l.current,p=r.getModifiedEditor(),E=r.getOriginalEditor(),s=r.getModel();if(!s)return;const m=s.modified.uri.toString();if(n.current===m)return;n.current=m,u.current&&u.current.dispose(),t.current.forEach(y=>{try{p.removeGlyphMarginWidget(y)}catch{}try{E.removeGlyphMarginWidget(y)}catch{}}),t.current=[];const g=()=>{t.current.forEach(f=>{try{p.removeGlyphMarginWidget(f)}catch{}try{E.removeGlyphMarginWidget(f)}catch{}});const y=r.getLineChanges();if(!y)return;const C=[];y.forEach(f=>{const{originalStartLineNumber:D,originalEndLineNumber:q,modifiedStartLineNumber:R,modifiedEndLineNumber:V}=f,I=j(f),_=()=>{const v=document.createElement("button");return v.innerHTML='<svg viewBox="0 0 14 14" width="14" height="14" style="margin: 0 4px;"><path d="M4.37934 0.21934C4.51979 0.359965 4.59868 0.550589 4.59868 0.74934C4.59868 0.948091 4.51979 1.13871 4.37934 1.27934L2.55934 3.09934H7.79934C8.51504 3.09934 9.22374 3.24031 9.88496 3.5142C10.5462 3.78808 11.147 4.18953 11.6531 4.69561C12.1592 5.20169 12.5606 5.80249 12.8345 6.46372C13.1084 7.12494 13.2493 7.83364 13.2493 8.54934C13.2493 9.26504 13.1084 9.97374 12.8345 10.635C12.5606 11.2962 12.1592 11.897 11.6531 12.4031C11.147 12.9092 10.5462 13.3106 9.88496 13.5845C9.22374 13.8584 8.51504 13.9993 7.79934 13.9993H3.14934C2.95043 13.9993 2.75966 13.9203 2.61901 13.7797C2.47836 13.639 2.39934 13.4483 2.39934 13.2493C2.39934 13.0504 2.47836 12.8597 2.61901 12.719C2.75966 12.5784 2.95043 12.4993 3.14934 12.4993H7.79934C8.84695 12.4993 9.85164 12.0832 10.5924 11.3424C11.3332 10.6016 11.7493 9.59695 11.7493 8.54934C11.7493 7.50174 11.3332 6.49704 10.5924 5.75627C9.85164 5.0155 8.84695 4.59934 7.79934 4.59934H2.55934L4.37934 6.41934C4.51182 6.56151 4.58394 6.74956 4.58051 6.94386C4.57709 7.13816 4.49837 7.32355 4.36096 7.46096C4.22355 7.59838 4.03816 7.67709 3.84386 7.68052C3.64956 7.68394 3.46152 7.61182 3.31934 7.47934L0.21934 4.37934C0.0788896 4.23871 0 4.04809 0 3.84934C0 3.65059 0.0788896 3.45997 0.21934 3.31934L3.31934 0.21934C3.45997 0.0788896 3.65059 0 3.84934 0C4.04809 0 4.23871 0.0788896 4.37934 0.21934Z"/></svg>',v.style.cssText="cursor: pointer; border: none; background: none; padding: 0; width: 100%; text-align: center; display: flex; align-items: center; justify-content: center;",v.onclick=w=>{var k,x,G;w.preventDefault(),w.stopPropagation();try{const N=p.getVisibleRanges(),P=(k=N==null?void 0:N[0])==null?void 0:k.startLineNumber,U=p.getScrollTop();e==null||e({scrollTop:U,firstVisibleLine:P})}catch{}const L=(x=r.getModel())==null?void 0:x.original.getValue(),A=(G=r.getModel())==null?void 0:G.modified.getValue();if(L&&A){const N=Y(L,A,f);c==null||c({packageId:o??"",version:a??"",slug:d??"",content:N}),i(f)}},v};if(I===T.remove){const v=D,w=new S(v,1,v,1),L={getId:()=>`line-control-remove-${D}-${q}`,getDomNode:_,getPosition:()=>({lane:h.GlyphMarginLane.Right,zIndex:10,range:w})};E.addGlyphMarginWidget(L),C.push(L)}else if(I===T.add){const v=R,w=new S(v,1,v,1),L={getId:()=>`line-control-add-${R}-${V}`,getDomNode:_,getPosition:()=>({lane:h.GlyphMarginLane.Right,zIndex:10,range:w})};p.addGlyphMarginWidget(L),C.push(L)}else if(I===T.change){const v=R,w=new S(v,1,v,1),L={getId:()=>`line-control-change-${R}-${V}`,getDomNode:_,getPosition:()=>({lane:h.GlyphMarginLane.Right,zIndex:10,range:w})};p.addGlyphMarginWidget(L),C.push(L)}}),t.current=C};return g(),u.current=r.onDidUpdateDiff(()=>{g()}),()=>{var y;(y=u.current)==null||y.dispose()}},[d,l,o,c,i,e,a])}function Y(l,i,e){const c=l.split(`
`),o=i.split(`
`),a=j(e);if(a===T.add){const d=[...o],t=e.modifiedEndLineNumber-e.modifiedStartLineNumber+1;return d.splice(e.modifiedStartLineNumber-1,t),d.join(`
`)}if(a===T.remove){const d=c.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),t=[...o];return t.splice(e.originalStartLineNumber-1,0,...d),t.join(`
`)}if(a===T.change){const d=c.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),t=[...o],n=e.modifiedEndLineNumber-e.modifiedStartLineNumber+1;return t.splice(e.modifiedStartLineNumber-1,n,...d),t.join(`
`)}return""}function j(l){const{originalStartLineNumber:i,originalEndLineNumber:e,modifiedStartLineNumber:c,modifiedEndLineNumber:o}=l,a=e>=i&&i>0,d=o>=c&&c>0;return a?d?T.change:T.remove:T.add}function Z(l){const{before:i,after:e,type:c,language:o=H,selectedUri:a,requestRevertChange:d}=l,t=b.useRef(null),n=b.useRef(),[u,r]=b.useState(void 0),[p,E]=b.useState(void 0);return B(()=>(h.defineTheme("custom",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#FFFFFF"}}),n.current=h.createDiffEditor(t.current,{minimap:{enabled:!0},hover:{above:!1},automaticLayout:!0,readOnly:!0,wordWrap:"on",glyphMargin:!0,theme:"custom",stickyScroll:{enabled:!1}}),()=>{var s,m;try{(s=n.current)==null||s.setModel(null)}catch{}(m=n.current)==null||m.dispose(),n.current=void 0})),b.useEffect(()=>{var y,C;const s=(y=n.current)==null?void 0:y.getModifiedEditor(),m=(s==null?void 0:s.getScrollTop())??0,M=h.createModel(i,o),g=h.createModel(e,o);if((C=n.current)==null||C.setModel({original:M,modified:g}),u)if(p)J(n.current,p),E(void 0),r(void 0);else{const f=u.modifiedStartLineNumber;f!==void 0&&F(n.current,f),r(void 0)}else s&&m>0&&s.setScrollTop(m,h.ScrollType.Immediate);return()=>{const{current:f}=n,D=f==null?void 0:f.getModel();if(f&&D&&D.original===M&&D.modified===g)try{f.setModel(null)}catch{}M.dispose(),g.dispose()}},[n,i,e,o,c,u,p]),X(n,r,E,d),b.useEffect(()=>{var m,M;const s=(M=(m=n.current)==null?void 0:m.getModel())==null?void 0:M.modified.getValue();if(s&&a){const g=z(s,a),y=g==null?void 0:g.range.start.line;y!==void 0&&F(n.current,y+1)}},[a]),t}function F(l,i){const e=l.getModifiedEditor(),c=300,o=Date.now()+c;let a=0;const d=30,t=()=>{const s=Date.now();if(s-a<d)return;a=s;const m=new S(i,1,i,1);e.revealRangeNearTop(m,h.ScrollType.Smooth),e.setSelection(m),e.focus()};e.getModel()&&requestAnimationFrame(()=>{t()});const u=[],r=()=>{u.forEach(s=>{try{s.dispose()}catch{}})};u.push(l.onDidUpdateDiff(()=>{t(),Date.now()>o&&r()})),u.push(e.onDidLayoutChange(()=>{t(),Date.now()>o&&r()})),u.push(e.onDidScrollChange(()=>{t(),Date.now()>o&&r()})),setTimeout(()=>{t(),Date.now()>o&&r()},50);let p=3;const E=()=>{const m=e.getVisibleRanges().some(g=>g.startLineNumber<=i&&g.endLineNumber>=i),M=e.getScrollTop()>0||i===1;m||M||p<=0||(p-=1,setTimeout(()=>{const g=new S(i,1,i,1);e.revealRangeNearTop(g,h.ScrollType.Smooth),requestAnimationFrame(E)},60))};requestAnimationFrame(E)}function J(l,i){const e=l.getModifiedEditor(),c=300,o=Date.now()+c;let a=0;const d=30,t=()=>{const r=Date.now();if(!(r-a<d))if(a=r,i.firstVisibleLine!==void 0){const p=new S(i.firstVisibleLine,1,i.firstVisibleLine,1);e.revealRangeAtTop(p,h.ScrollType.Immediate)}else e.setScrollTop(i.scrollTop,h.ScrollType.Immediate)},n=[],u=()=>{n.forEach(r=>{try{r.dispose()}catch{}})};requestAnimationFrame(t),n.push(l.onDidUpdateDiff(()=>{t(),Date.now()>o&&u()})),n.push(e.onDidLayoutChange(()=>{t(),Date.now()>o&&u()})),n.push(e.onDidScrollChange(()=>{t(),Date.now()>o&&u()})),setTimeout(()=>{t(),Date.now()>o&&u()},50)}const W=b.memo(l=>{const{before:i,after:e,type:c,language:o,selectedUri:a,requestRevertChange:d}=l,t=Z({before:i,after:e,type:c,language:o,selectedUri:a,requestRevertChange:d});return O("div",{ref:t,style:{height:"100%"}})});try{W.displayName="MonacoDiffEditorElement",W.__docgenInfo={description:"",displayName:"MonacoDiffEditorElement",props:{before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"string"}},after:{defaultValue:null,description:"",name:"after",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"graphql"'},{value:'"openapi-3-1"'},{value:'"openapi-3-0"'},{value:'"openapi-2-0"'},{value:'"openapi"'},{value:'"asyncapi-2"'},{value:'"json-schema"'},{value:'"markdown"'},{value:'"unknown"'},{value:'"graphql-schema"'},{value:'"graphapi"'},{value:'"introspection"'},{value:'"protobuf-3"'}]}},language:{defaultValue:null,description:"",name:"language",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"graphql"'},{value:'"markdown"'},{value:'"yaml"'},{value:'"json"'},{value:'"proto"'}]}},selectedUri:{defaultValue:null,description:"",name:"selectedUri",required:!1,type:{name:"`/${string}`"}},requestRevertChange:{defaultValue:null,description:"",name:"requestRevertChange",required:!1,type:{name:"RevertChangeInAiEnhancedPackageVersionMutationFn"}}}}}catch{}export{W as default};
//# sourceMappingURL=MonacoDiffEditorElement-331c866b.js.map
