{"version":3,"file":"MonacoDiffEditorElement-33eac26f.js","sources":["../../packages/shared/src/components/MonacoDiffEditor/useAddLineControls.tsx","../../packages/shared/src/components/MonacoDiffEditor/useMonacoDiffEditorElement.ts","../../packages/shared/src/components/MonacoDiffEditor/MonacoDiffEditorElement.tsx"],"sourcesContent":["import { editor as Editor, Range } from 'monaco-editor'\nimport type { MutableRefObject } from 'react'\nimport { useEffect, useRef } from 'react'\n\nexport function useAddLineControls(\n  editor: MutableRefObject<Editor.IStandaloneDiffEditor | undefined>,\n): void {\n  const widgetsRef = useRef<Editor.IGlyphMarginWidget[]>([])\n  const modelIdRef = useRef<string | null>(null)\n  const disposableRef = useRef<{ dispose: () => void } | null>(null)\n\n  useEffect(() => {\n    if (!editor.current) {\n      return\n    }\n\n    const diffEditor = editor.current\n    const modifiedEditor = diffEditor.getModifiedEditor()\n    const model = diffEditor.getModel()\n\n    if (!model) {\n      return\n    }\n\n    const currentModelId = model.modified.uri.toString()\n\n    // Only create widgets if model changed\n    if (modelIdRef.current === currentModelId) {\n      return\n    }\n\n    modelIdRef.current = currentModelId\n\n    // Cleanup previous subscription and widgets\n    if (disposableRef.current) {\n      disposableRef.current.dispose()\n    }\n\n    const currentWidgets = widgetsRef.current\n\n    currentWidgets.forEach((widget) => {\n      modifiedEditor.removeGlyphMarginWidget(widget)\n    })\n\n    widgetsRef.current = []\n\n    // Function to add line controls\n    const addLineControls = (): void => {\n      // Clean up existing widgets before adding new ones\n      widgetsRef.current.forEach((widget) => {\n        modifiedEditor.removeGlyphMarginWidget(widget)\n      })\n\n      const lineChanges = diffEditor.getLineChanges()\n\n      console.log('Number of changes:', lineChanges?.length)\n\n      if (!lineChanges) {\n        return\n      }\n\n      const widgets: Editor.IGlyphMarginWidget[] = []\n\n      // Create a glyph margin widget only for lines in changed fragments\n      lineChanges.forEach((change) => {\n        // Get the range of modified lines for this change\n        const modifiedStartLine = change.modifiedStartLineNumber\n        const modifiedEndLine = change.modifiedEndLineNumber\n\n        console.log(`Adding controls for lines ${modifiedStartLine} to ${modifiedEndLine}`)\n\n        // Create a button for each line in the changed fragment\n        for (let lineNumber = modifiedStartLine; lineNumber <= modifiedEndLine; lineNumber++) {\n          // Create simple HTML button\n          const button = document.createElement('button')\n          button.textContent = 'â†’'\n          button.style.cssText = 'cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;'\n\n          button.onclick = (e) => {\n            e.preventDefault()\n            e.stopPropagation()\n            console.log(`Line control clicked for line ${lineNumber}`)\n          }\n\n          const widget: Editor.IGlyphMarginWidget = {\n            getId: () => `line-control-${lineNumber}`,\n            getDomNode: () => button,\n            getPosition: () => ({\n              lane: Editor.GlyphMarginLane.Right,\n              zIndex: 10,\n              range: new Range(lineNumber, 1, lineNumber, 1),\n            }),\n          }\n\n          modifiedEditor.addGlyphMarginWidget(widget)\n          widgets.push(widget)\n        }\n      })\n\n      console.log(`Total widgets added: ${widgets.length}`)\n\n      widgetsRef.current = widgets\n    }\n\n    // Try to add controls immediately\n    addLineControls()\n\n    // Subscribe to diff updates to add controls when diff is computed\n    disposableRef.current = diffEditor.onDidUpdateDiff(() => {\n      console.log('onDidUpdateDiff triggered')\n      addLineControls()\n    })\n\n    return () => {\n      if (disposableRef.current) {\n        disposableRef.current.dispose()\n      }\n    }\n  }, [editor])\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { RefObject } from 'react'\nimport { useEffect, useRef } from 'react'\nimport { editor as Editor } from 'monaco-editor'\nimport { useEffectOnce } from 'react-use'\nimport type { SpecType } from '../../utils/specs'\nimport type { LanguageType } from '../../types/languages'\nimport { LANGUAGE_TYPE_TEXT } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\nimport { findPathLocation } from '../../utils/specifications'\nimport { useAddLineControls } from './useAddLineControls'\n\nexport function useMonacoDiffEditorElement(options: {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n}): RefObject<HTMLDivElement> {\n  const { before, after, type, language = LANGUAGE_TYPE_TEXT, selectedUri } = options\n\n  const ref = useRef<HTMLDivElement>(null)\n  const editor = useRef<Editor.IStandaloneDiffEditor>()\n\n  useEffectOnce(() => {\n    Editor.defineTheme('custom', {\n      base: 'vs',\n      inherit: true,\n      rules: [],\n      colors: {\n        'editor.background': '#FFFFFF',\n      },\n    })\n\n    editor.current = Editor.createDiffEditor(ref.current!, {\n      minimap: { enabled: true },\n      hover: { above: false },\n      automaticLayout: true,\n      readOnly: true,\n      wordWrap: 'on',\n      glyphMargin: true,\n      theme: 'custom',\n    })\n\n    return () => {\n      editor.current?.dispose()\n    }\n  })\n\n  useEffect(() => {\n    //todo resolve problem with load schema model by filename (like in useSetEditorModel)\n    editor.current?.setModel({\n      original: Editor.createModel(before, language),\n      modified: Editor.createModel(after, language),\n    })\n\n    return () => {\n      editor.current?.getModel()?.original?.dispose()\n      editor.current?.getModel()?.modified?.dispose()\n    }\n  }, [editor, before, after, language, type])\n\n  useAddLineControls(editor)\n\n  useEffect(() => {\n    const content = editor.current?.getModel()?.modified.getValue()\n    if (selectedUri && content) {\n      const location = findPathLocation(content, selectedUri)\n      if (location) {\n        const startLine = location?.range.start.line\n        navigateTo(editor.current!, startLine + 1)\n      }\n    }\n  }, [selectedUri])\n\n  return ref\n}\n\nfunction navigateTo(\n  editor: Editor.IStandaloneDiffEditor,\n  lineNumber: number,\n): void {\n  editor.revealLineNearTop(lineNumber, Editor.ScrollType.Smooth)\n  editor.setPosition({ lineNumber: lineNumber, column: 0 })\n  editor.focus()\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'monaco-editor/esm/vs/editor/editor.all.js'\nimport 'monaco-editor/esm/vs/language/json/monaco.contribution'\nimport 'monaco-editor/esm/vs/basic-languages/yaml/yaml.contribution'\nimport 'monaco-editor/esm/vs/basic-languages/markdown/markdown.contribution'\n\nimport type { FC } from 'react'\nimport { memo } from 'react'\nimport { useMonacoDiffEditorElement } from './useMonacoDiffEditorElement'\nimport type { SpecType } from '../../utils/specs'\nimport type { LanguageType } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\n\nexport type MonacoDiffEditorElementProps = {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n}\n\nconst MonacoDiffEditorElement: FC<MonacoDiffEditorElementProps> = memo<MonacoDiffEditorElementProps>(({\n  before,\n  after,\n  type,\n  language,\n  selectedUri,\n}) => {\n  const element = useMonacoDiffEditorElement({ before, after, type, language, selectedUri })\n\n  return (\n    <div\n      ref={element}\n      style={{ height: '100%' }}\n    />\n  )\n})\n\nexport default MonacoDiffEditorElement\n"],"names":["useAddLineControls","editor","widgetsRef","useRef","modelIdRef","disposableRef","useEffect","diffEditor","modifiedEditor","model","currentModelId","widget","addLineControls","lineChanges","widgets","change","modifiedStartLine","modifiedEndLine","lineNumber","button","e","Editor","Range","useMonacoDiffEditorElement","options","before","after","type","language","LANGUAGE_TYPE_TEXT","selectedUri","ref","useEffectOnce","content","location","findPathLocation","startLine","navigateTo","MonacoDiffEditorElement","memo","element","jsx"],"mappings":"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"}