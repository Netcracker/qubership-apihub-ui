{"version":3,"file":"MonacoDiffEditorElement-ea5f7bc6.js","sources":["../../node_modules/@tanstack/query-core/build/lib/mutation.mjs","../../node_modules/@tanstack/query-core/build/lib/mutationObserver.mjs","../../node_modules/@tanstack/react-query/build/lib/useMutation.mjs","../../packages/shared/src/hooks/ai-agent/useInvalidateAiEnhancedDocumentRawContent.ts","../../packages/shared/src/hooks/ai-agent/useRevertChangeInEnhancedDocument.ts","../../packages/shared/src/components/MonacoDiffEditor/useAddLineControls.tsx","../../packages/shared/src/components/MonacoDiffEditor/useMonacoDiffEditorElement.ts","../../packages/shared/src/components/MonacoDiffEditor/MonacoDiffEditorElement.tsx"],"sourcesContent":["import { defaultLogger } from './logger.mjs';\nimport { notifyManager } from './notifyManager.mjs';\nimport { Removable } from './removable.mjs';\nimport { createRetryer, canFetch } from './retryer.mjs';\n\n// CLASS\nclass Mutation extends Removable {\n  constructor(config) {\n    super();\n    this.options = { ...config.defaultOptions,\n      ...config.options\n    };\n    this.mutationId = config.mutationId;\n    this.mutationCache = config.mutationCache;\n    this.logger = config.logger || defaultLogger;\n    this.observers = [];\n    this.state = config.state || getDefaultState();\n    this.updateCacheTime(this.options.cacheTime);\n    this.scheduleGc();\n  }\n\n  get meta() {\n    return this.options.meta;\n  }\n\n  setState(state) {\n    this.dispatch({\n      type: 'setState',\n      state\n    });\n  }\n\n  addObserver(observer) {\n    if (this.observers.indexOf(observer) === -1) {\n      this.observers.push(observer); // Stop the mutation from being garbage collected\n\n      this.clearGcTimeout();\n      this.mutationCache.notify({\n        type: 'observerAdded',\n        mutation: this,\n        observer\n      });\n    }\n  }\n\n  removeObserver(observer) {\n    this.observers = this.observers.filter(x => x !== observer);\n    this.scheduleGc();\n    this.mutationCache.notify({\n      type: 'observerRemoved',\n      mutation: this,\n      observer\n    });\n  }\n\n  optionalRemove() {\n    if (!this.observers.length) {\n      if (this.state.status === 'loading') {\n        this.scheduleGc();\n      } else {\n        this.mutationCache.remove(this);\n      }\n    }\n  }\n\n  continue() {\n    var _this$retryer$continu, _this$retryer;\n\n    return (_this$retryer$continu = (_this$retryer = this.retryer) == null ? void 0 : _this$retryer.continue()) != null ? _this$retryer$continu : this.execute();\n  }\n\n  async execute() {\n    const executeMutation = () => {\n      var _this$options$retry;\n\n      this.retryer = createRetryer({\n        fn: () => {\n          if (!this.options.mutationFn) {\n            return Promise.reject('No mutationFn found');\n          }\n\n          return this.options.mutationFn(this.state.variables);\n        },\n        onFail: (failureCount, error) => {\n          this.dispatch({\n            type: 'failed',\n            failureCount,\n            error\n          });\n        },\n        onPause: () => {\n          this.dispatch({\n            type: 'pause'\n          });\n        },\n        onContinue: () => {\n          this.dispatch({\n            type: 'continue'\n          });\n        },\n        retry: (_this$options$retry = this.options.retry) != null ? _this$options$retry : 0,\n        retryDelay: this.options.retryDelay,\n        networkMode: this.options.networkMode\n      });\n      return this.retryer.promise;\n    };\n\n    const restored = this.state.status === 'loading';\n\n    try {\n      var _this$mutationCache$c3, _this$mutationCache$c4, _this$options$onSucce, _this$options2, _this$options$onSettl, _this$options3;\n\n      if (!restored) {\n        var _this$mutationCache$c, _this$mutationCache$c2, _this$options$onMutat, _this$options;\n\n        this.dispatch({\n          type: 'loading',\n          variables: this.options.variables\n        }); // Notify cache callback\n\n        await ((_this$mutationCache$c = (_this$mutationCache$c2 = this.mutationCache.config).onMutate) == null ? void 0 : _this$mutationCache$c.call(_this$mutationCache$c2, this.state.variables, this));\n        const context = await ((_this$options$onMutat = (_this$options = this.options).onMutate) == null ? void 0 : _this$options$onMutat.call(_this$options, this.state.variables));\n\n        if (context !== this.state.context) {\n          this.dispatch({\n            type: 'loading',\n            context,\n            variables: this.state.variables\n          });\n        }\n      }\n\n      const data = await executeMutation(); // Notify cache callback\n\n      await ((_this$mutationCache$c3 = (_this$mutationCache$c4 = this.mutationCache.config).onSuccess) == null ? void 0 : _this$mutationCache$c3.call(_this$mutationCache$c4, data, this.state.variables, this.state.context, this));\n      await ((_this$options$onSucce = (_this$options2 = this.options).onSuccess) == null ? void 0 : _this$options$onSucce.call(_this$options2, data, this.state.variables, this.state.context));\n      await ((_this$options$onSettl = (_this$options3 = this.options).onSettled) == null ? void 0 : _this$options$onSettl.call(_this$options3, data, null, this.state.variables, this.state.context));\n      this.dispatch({\n        type: 'success',\n        data\n      });\n      return data;\n    } catch (error) {\n      try {\n        var _this$mutationCache$c5, _this$mutationCache$c6, _this$options$onError, _this$options4, _this$options$onSettl2, _this$options5;\n\n        // Notify cache callback\n        await ((_this$mutationCache$c5 = (_this$mutationCache$c6 = this.mutationCache.config).onError) == null ? void 0 : _this$mutationCache$c5.call(_this$mutationCache$c6, error, this.state.variables, this.state.context, this));\n\n        if (process.env.NODE_ENV !== 'production') {\n          this.logger.error(error);\n        }\n\n        await ((_this$options$onError = (_this$options4 = this.options).onError) == null ? void 0 : _this$options$onError.call(_this$options4, error, this.state.variables, this.state.context));\n        await ((_this$options$onSettl2 = (_this$options5 = this.options).onSettled) == null ? void 0 : _this$options$onSettl2.call(_this$options5, undefined, error, this.state.variables, this.state.context));\n        throw error;\n      } finally {\n        this.dispatch({\n          type: 'error',\n          error: error\n        });\n      }\n    }\n  }\n\n  dispatch(action) {\n    const reducer = state => {\n      switch (action.type) {\n        case 'failed':\n          return { ...state,\n            failureCount: action.failureCount,\n            failureReason: action.error\n          };\n\n        case 'pause':\n          return { ...state,\n            isPaused: true\n          };\n\n        case 'continue':\n          return { ...state,\n            isPaused: false\n          };\n\n        case 'loading':\n          return { ...state,\n            context: action.context,\n            data: undefined,\n            failureCount: 0,\n            failureReason: null,\n            error: null,\n            isPaused: !canFetch(this.options.networkMode),\n            status: 'loading',\n            variables: action.variables\n          };\n\n        case 'success':\n          return { ...state,\n            data: action.data,\n            failureCount: 0,\n            failureReason: null,\n            error: null,\n            status: 'success',\n            isPaused: false\n          };\n\n        case 'error':\n          return { ...state,\n            data: undefined,\n            error: action.error,\n            failureCount: state.failureCount + 1,\n            failureReason: action.error,\n            isPaused: false,\n            status: 'error'\n          };\n\n        case 'setState':\n          return { ...state,\n            ...action.state\n          };\n      }\n    };\n\n    this.state = reducer(this.state);\n    notifyManager.batch(() => {\n      this.observers.forEach(observer => {\n        observer.onMutationUpdate(action);\n      });\n      this.mutationCache.notify({\n        mutation: this,\n        type: 'updated',\n        action\n      });\n    });\n  }\n\n}\nfunction getDefaultState() {\n  return {\n    context: undefined,\n    data: undefined,\n    error: null,\n    failureCount: 0,\n    failureReason: null,\n    isPaused: false,\n    status: 'idle',\n    variables: undefined\n  };\n}\n\nexport { Mutation, getDefaultState };\n//# sourceMappingURL=mutation.mjs.map\n","import { getDefaultState } from './mutation.mjs';\nimport { notifyManager } from './notifyManager.mjs';\nimport { Subscribable } from './subscribable.mjs';\nimport { shallowEqualObjects } from './utils.mjs';\n\n// CLASS\nclass MutationObserver extends Subscribable {\n  constructor(client, options) {\n    super();\n    this.client = client;\n    this.setOptions(options);\n    this.bindMethods();\n    this.updateResult();\n  }\n\n  bindMethods() {\n    this.mutate = this.mutate.bind(this);\n    this.reset = this.reset.bind(this);\n  }\n\n  setOptions(options) {\n    const prevOptions = this.options;\n    this.options = this.client.defaultMutationOptions(options);\n\n    if (!shallowEqualObjects(prevOptions, this.options)) {\n      this.client.getMutationCache().notify({\n        type: 'observerOptionsUpdated',\n        mutation: this.currentMutation,\n        observer: this\n      });\n    }\n  }\n\n  onUnsubscribe() {\n    if (!this.listeners.length) {\n      var _this$currentMutation;\n\n      (_this$currentMutation = this.currentMutation) == null ? void 0 : _this$currentMutation.removeObserver(this);\n    }\n  }\n\n  onMutationUpdate(action) {\n    this.updateResult(); // Determine which callbacks to trigger\n\n    const notifyOptions = {\n      listeners: true\n    };\n\n    if (action.type === 'success') {\n      notifyOptions.onSuccess = true;\n    } else if (action.type === 'error') {\n      notifyOptions.onError = true;\n    }\n\n    this.notify(notifyOptions);\n  }\n\n  getCurrentResult() {\n    return this.currentResult;\n  }\n\n  reset() {\n    this.currentMutation = undefined;\n    this.updateResult();\n    this.notify({\n      listeners: true\n    });\n  }\n\n  mutate(variables, options) {\n    this.mutateOptions = options;\n\n    if (this.currentMutation) {\n      this.currentMutation.removeObserver(this);\n    }\n\n    this.currentMutation = this.client.getMutationCache().build(this.client, { ...this.options,\n      variables: typeof variables !== 'undefined' ? variables : this.options.variables\n    });\n    this.currentMutation.addObserver(this);\n    return this.currentMutation.execute();\n  }\n\n  updateResult() {\n    const state = this.currentMutation ? this.currentMutation.state : getDefaultState();\n    const result = { ...state,\n      isLoading: state.status === 'loading',\n      isSuccess: state.status === 'success',\n      isError: state.status === 'error',\n      isIdle: state.status === 'idle',\n      mutate: this.mutate,\n      reset: this.reset\n    };\n    this.currentResult = result;\n  }\n\n  notify(options) {\n    notifyManager.batch(() => {\n      // First trigger the mutate callbacks\n      if (this.mutateOptions && this.hasListeners()) {\n        if (options.onSuccess) {\n          var _this$mutateOptions$o, _this$mutateOptions, _this$mutateOptions$o2, _this$mutateOptions2;\n\n          (_this$mutateOptions$o = (_this$mutateOptions = this.mutateOptions).onSuccess) == null ? void 0 : _this$mutateOptions$o.call(_this$mutateOptions, this.currentResult.data, this.currentResult.variables, this.currentResult.context);\n          (_this$mutateOptions$o2 = (_this$mutateOptions2 = this.mutateOptions).onSettled) == null ? void 0 : _this$mutateOptions$o2.call(_this$mutateOptions2, this.currentResult.data, null, this.currentResult.variables, this.currentResult.context);\n        } else if (options.onError) {\n          var _this$mutateOptions$o3, _this$mutateOptions3, _this$mutateOptions$o4, _this$mutateOptions4;\n\n          (_this$mutateOptions$o3 = (_this$mutateOptions3 = this.mutateOptions).onError) == null ? void 0 : _this$mutateOptions$o3.call(_this$mutateOptions3, this.currentResult.error, this.currentResult.variables, this.currentResult.context);\n          (_this$mutateOptions$o4 = (_this$mutateOptions4 = this.mutateOptions).onSettled) == null ? void 0 : _this$mutateOptions$o4.call(_this$mutateOptions4, undefined, this.currentResult.error, this.currentResult.variables, this.currentResult.context);\n        }\n      } // Then trigger the listeners\n\n\n      if (options.listeners) {\n        this.listeners.forEach(listener => {\n          listener(this.currentResult);\n        });\n      }\n    });\n  }\n\n}\n\nexport { MutationObserver };\n//# sourceMappingURL=mutationObserver.mjs.map\n","import * as React from 'react';\nimport { useSyncExternalStore } from './useSyncExternalStore.mjs';\nimport { parseMutationArgs, MutationObserver, notifyManager } from '@tanstack/query-core';\nimport { useQueryClient } from './QueryClientProvider.mjs';\nimport { shouldThrowError } from './utils.mjs';\n\nfunction useMutation(arg1, arg2, arg3) {\n  const options = parseMutationArgs(arg1, arg2, arg3);\n  const queryClient = useQueryClient({\n    context: options.context\n  });\n  const [observer] = React.useState(() => new MutationObserver(queryClient, options));\n  React.useEffect(() => {\n    observer.setOptions(options);\n  }, [observer, options]);\n  const result = useSyncExternalStore(React.useCallback(onStoreChange => observer.subscribe(notifyManager.batchCalls(onStoreChange)), [observer]), () => observer.getCurrentResult(), () => observer.getCurrentResult());\n  const mutate = React.useCallback((variables, mutateOptions) => {\n    observer.mutate(variables, mutateOptions).catch(noop);\n  }, [observer]);\n\n  if (result.error && shouldThrowError(observer.options.useErrorBoundary, [result.error])) {\n    throw result.error;\n  }\n\n  return { ...result,\n    mutate,\n    mutateAsync: result.mutate\n  };\n} // eslint-disable-next-line @typescript-eslint/no-empty-function\n\nfunction noop() {}\n\nexport { useMutation };\n//# sourceMappingURL=useMutation.mjs.map\n","import { useQueryClient } from '@tanstack/react-query'\n\nexport const QUERY_KEY_AI_ENHANCED_DOCUMENT_RAW_CONTENT = 'ai-enhanced-document-raw-content'\n\nexport function useInvalidateAiEnhancedDocumentRawContent(): () => Promise<void> {\n  const queryClient = useQueryClient()\n  return () => queryClient.invalidateQueries({ \n    queryKey: [QUERY_KEY_AI_ENHANCED_DOCUMENT_RAW_CONTENT],\n  })\n}\n","import { useMutation } from '@tanstack/react-query'\nimport { generatePath } from 'react-router'\nimport type { Key } from '../../entities/keys'\nimport { requestJson, STUB_API_V1 } from '../../utils/requests'\nimport { useInvalidateAiEnhancedDocumentRawContent } from './useInvalidateAiEnhancedDocumentRawContent'\n\ntype RevertAiEnhancedPackageVersionRequest = {\n  packageId: Key\n  version: Key\n  slug: Key\n  content: string\n}\n\ntype RevertAiEnhancedPackageVersionResponse = {\n  message: string\n}\n\ntype RevertMutationFn = (request: RevertAiEnhancedPackageVersionRequest) => void\n\ntype RevertMutationState = {\n  mutate: RevertMutationFn\n  isReverting: boolean\n}\n\nexport function useRevertChangeInEnhancedDocument(): RevertMutationState {\n  const invalidateAiEnhancedDocumentRawContent = useInvalidateAiEnhancedDocumentRawContent()\n\n  const { mutate, isLoading: isReverting } = useMutation<\n    RevertAiEnhancedPackageVersionResponse,\n    Error,\n    RevertAiEnhancedPackageVersionRequest\n  >({\n    mutationFn: request => revert(request),\n    onSuccess: async () => {\n      await invalidateAiEnhancedDocumentRawContent()\n    },\n  })\n\n  return { mutate, isReverting }\n}\nfunction revert(request: RevertAiEnhancedPackageVersionRequest): Promise<RevertAiEnhancedPackageVersionResponse> {\n  const { packageId, version, slug, content } = request\n  const packageKey = encodeURIComponent(packageId)\n  const versionKey = encodeURIComponent(version)\n  const documentKey = encodeURIComponent(slug)\n\n  const endpointPattern = '/packages/:packageId/versions/:versionId/enhancedFiles/:documentId/raw'\n  const endpoint = generatePath(endpointPattern, {\n    packageId: packageKey,\n    versionId: versionKey,\n    documentId: documentKey,\n  })\n  return requestJson<RevertAiEnhancedPackageVersionResponse>(\n    endpoint,\n    {\n      method: 'PUT',\n      body: content,\n    },\n    { basePath: STUB_API_V1 },\n  )\n}\n","import { editor as Editor, Range } from 'monaco-editor'\nimport type { Dispatch, MutableRefObject, SetStateAction } from 'react'\nimport { useEffect, useRef } from 'react'\nimport { useParams } from 'react-router'\nimport { useRevertChangeInEnhancedDocument } from '../../hooks/ai-agent/useRevertChangeInEnhancedDocument'\n\nconst RawDiffTypes = {\n  add: 'add',\n  remove: 'remove',\n  change: 'change',\n}\ntype RawDiffType = typeof RawDiffTypes[keyof typeof RawDiffTypes]\n\nexport function useAddLineControls(\n  editor: MutableRefObject<Editor.IStandaloneDiffEditor | undefined>,\n  setRevertedChange: Dispatch<SetStateAction<Editor.ILineChange | undefined>>,\n  setViewSnapshot?: Dispatch<SetStateAction<{ scrollTop: number; firstVisibleLine?: number } | undefined>>,\n): void {\n  const { packageId, versionId, documentId } = useParams()\n  const { mutate: revert } = useRevertChangeInEnhancedDocument()\n\n  const widgetsRef = useRef<Editor.IGlyphMarginWidget[]>([])\n  const modelIdRef = useRef<string | null>(null)\n  const disposableRef = useRef<{ dispose: () => void } | null>(null)\n\n  useEffect(() => {\n    if (!editor.current) {\n      return\n    }\n\n    const diffEditor = editor.current\n    const modifiedEditor = diffEditor.getModifiedEditor()\n    const model = diffEditor.getModel()\n\n    if (!model) {\n      return\n    }\n\n    const currentModelId = model.modified.uri.toString()\n\n    // Only create widgets if model changed\n    if (modelIdRef.current === currentModelId) {\n      return\n    }\n\n    modelIdRef.current = currentModelId\n\n    // Cleanup previous subscription and widgets\n    if (disposableRef.current) {\n      disposableRef.current.dispose()\n    }\n\n    const currentWidgets = widgetsRef.current\n\n    currentWidgets.forEach((widget) => {\n      modifiedEditor.removeGlyphMarginWidget(widget)\n    })\n\n    widgetsRef.current = []\n\n    // Function to add line controls\n    const addLineControls = (): void => {\n      // Clean up existing widgets before adding new ones\n      widgetsRef.current.forEach((widget) => {\n        modifiedEditor.removeGlyphMarginWidget(widget)\n      })\n\n      const lineChanges = diffEditor.getLineChanges()\n\n      if (!lineChanges) {\n        return\n      }\n\n      const widgets: Editor.IGlyphMarginWidget[] = []\n\n      // Create a glyph margin widget only for lines in changed fragments\n      lineChanges.forEach((change) => {\n        // Get the range of modified lines for this change\n        const {\n          modifiedStartLineNumber,\n          modifiedEndLineNumber,\n        } = change\n\n        const diffType: RawDiffType = detectDiffType(change)\n\n        // Create a button for each line in the changed fragment\n        for (let lineNumber = modifiedStartLineNumber; lineNumber <= modifiedEndLineNumber; lineNumber++) {\n          // Create simple HTML button\n          const button = document.createElement('button')\n          button.textContent = 'â†’'\n          button.style.cssText = 'cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;'\n\n          button.onclick = (e) => {\n            e.preventDefault()\n            e.stopPropagation()\n            // Capture current viewport state before triggering revert\n            try {\n              const currentRanges = modifiedEditor.getVisibleRanges()\n              const firstVisibleLine = currentRanges?.[0]?.startLineNumber\n              const scrollTop = modifiedEditor.getScrollTop()\n              setViewSnapshot?.({ scrollTop, firstVisibleLine })\n            } catch (_) {\n              // ignore snapshot errors\n            }\n            const originalValue = diffEditor.getModel()?.original.getValue()\n            const modifiedValue = diffEditor.getModel()?.modified.getValue()\n            if (originalValue && modifiedValue) {\n              const revertedValue = revertChange(originalValue, modifiedValue, change)\n              revert({\n                packageId: packageId ?? '',\n                version: versionId ?? '',\n                slug: documentId ?? '',\n                content: revertedValue,\n              })\n              setRevertedChange(change)\n            }\n          }\n\n          let range: Range\n          if (diffType === RawDiffTypes.add) {\n            range = new Range(lineNumber, 1, modifiedEndLineNumber, 1)\n            lineNumber += modifiedEndLineNumber - lineNumber + 1\n          } else {\n            range = new Range(lineNumber, 1, lineNumber, 1)\n          }\n\n          const widget: Editor.IGlyphMarginWidget = {\n            getId: () => `line-control-${lineNumber}`,\n            getDomNode: () => button,\n            getPosition: () => ({\n              lane: Editor.GlyphMarginLane.Right,\n              zIndex: 10,\n              range: range,\n            }),\n          }\n\n          modifiedEditor.addGlyphMarginWidget(widget)\n          widgets.push(widget)\n        }\n      })\n\n      widgetsRef.current = widgets\n    }\n\n    // Try to add controls immediately\n    addLineControls()\n\n    // Subscribe to diff updates to add controls when diff is computed\n    disposableRef.current = diffEditor.onDidUpdateDiff(() => { addLineControls() })\n\n    return () => { disposableRef.current?.dispose() }\n  }, [documentId, editor, packageId, revert, setRevertedChange, setViewSnapshot, versionId])\n}\n\n/**\n * Receives original and modified values and a change and returns modified value with reverted change\n * @param originalValue Original value\n * @param modifiedValue Modified value\n * @param change MonacoEditor line change\n * @returns Modified value with reverted change\n */\nfunction revertChange(\n  originalValue: string,\n  modifiedValue: string,\n  change: Editor.ILineChange,\n): string {\n  const originalLines = originalValue.split('\\n')\n  const modifiedLines = modifiedValue.split('\\n')\n\n  const diffType: RawDiffType = detectDiffType(change)\n\n  if (diffType === RawDiffTypes.remove) {\n    const pickedOriginalLines = originalLines.slice(change.originalStartLineNumber - 1, change.originalEndLineNumber)\n    const updatedModifiedLines = [...modifiedLines]\n    updatedModifiedLines.splice(change.modifiedStartLineNumber - 1, 0, ...pickedOriginalLines)\n    return updatedModifiedLines.join('\\n')\n  }\n\n  if (diffType === RawDiffTypes.change) {\n    const pickedOriginalLines = originalLines.slice(change.originalStartLineNumber - 1, change.originalEndLineNumber)\n    const updatedModifiedLines = [...modifiedLines]\n    updatedModifiedLines.splice(change.modifiedStartLineNumber - 1, pickedOriginalLines.length, ...pickedOriginalLines)\n    return updatedModifiedLines.join('\\n')\n  }\n\n  if (diffType === RawDiffTypes.add) {\n    const updatedModifiedLines = modifiedLines.filter(\n      (_, index) => index < change.modifiedStartLineNumber - 1 || index > change.modifiedEndLineNumber - 1,\n    )\n    return updatedModifiedLines.join('\\n')\n  }\n\n  return ''\n}\n\n/**\n * Detects diff type from MonacoEditor line change\n * Variants:\n * - change: The line has been changed\n * - add: The line(s) has(ve) been added\n * - remove: The line(s) has(ve) been removed\n * @param change MonacoEditor line change\n * @returns Diff type\n */\nfunction detectDiffType(change: Editor.ILineChange): RawDiffType {\n  const {\n    originalStartLineNumber,\n    originalEndLineNumber,\n    modifiedStartLineNumber,\n    modifiedEndLineNumber,\n  } = change\n\n  const modifiedRange = modifiedEndLineNumber - modifiedStartLineNumber\n  const originalRange = originalEndLineNumber - originalStartLineNumber\n  if (modifiedRange === originalRange) {\n    return RawDiffTypes.change\n  }\n  return modifiedRange > originalRange\n    ? RawDiffTypes.add\n    : RawDiffTypes.remove\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { RefObject } from 'react'\nimport { useEffect, useRef, useState } from 'react'\nimport { editor as Editor, Range } from 'monaco-editor'\nimport { useEffectOnce } from 'react-use'\nimport type { SpecType } from '../../utils/specs'\nimport type { LanguageType } from '../../types/languages'\nimport { LANGUAGE_TYPE_TEXT } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\nimport { findPathLocation } from '../../utils/specifications'\nimport { useAddLineControls } from './useAddLineControls'\n\ntype EditorViewportSnapshot = {\n  scrollTop: number\n  firstVisibleLine?: number\n}\n\nexport function useMonacoDiffEditorElement(options: {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n}): RefObject<HTMLDivElement> {\n  const { before, after, type, language = LANGUAGE_TYPE_TEXT, selectedUri } = options\n\n  const ref = useRef<HTMLDivElement>(null)\n  const editor = useRef<Editor.IStandaloneDiffEditor>()\n\n  const [revertedChange, setRevertedChange] = useState<Editor.ILineChange | undefined>(undefined)\n  const [viewSnapshot, setViewSnapshot] = useState<EditorViewportSnapshot | undefined>(undefined)\n\n  useEffectOnce(() => {\n    Editor.defineTheme('custom', {\n      base: 'vs',\n      inherit: true,\n      rules: [],\n      colors: {\n        'editor.background': '#FFFFFF',\n      },\n    })\n\n    editor.current = Editor.createDiffEditor(ref.current!, {\n      minimap: { enabled: true },\n      hover: { above: false },\n      automaticLayout: true,\n      readOnly: true,\n      wordWrap: 'on',\n      glyphMargin: true,\n      theme: 'custom',\n    })\n\n    return () => {\n      try {\n        editor.current?.setModel(null)\n      } catch (_) {\n        // editor might already be disposed; ignore\n      }\n      editor.current?.dispose()\n      // prevent future calls on a disposed instance\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      editor.current = undefined\n    }\n  })\n\n  useEffect(() => {\n    //todo resolve problem with load schema model by filename (like in useSetEditorModel)\n\n    // Capture current scroll position before model swap to prevent jump to top\n    const modifiedEditor = editor.current?.getModifiedEditor()\n    const previousScrollTop = modifiedEditor?.getScrollTop() ?? 0\n\n    const originalModel = Editor.createModel(before, language)\n    const modifiedModel = Editor.createModel(after, language)\n\n    editor.current?.setModel({\n      original: originalModel,\n      modified: modifiedModel,\n    })\n\n    // Immediately restore scroll position after model swap to prevent visible jump\n    if (modifiedEditor && previousScrollTop > 0) {\n      modifiedEditor.setScrollTop(previousScrollTop, Editor.ScrollType.Immediate)\n    }\n\n    if (revertedChange) {\n      // If we have a pre-revert viewport snapshot, restore it; otherwise, navigate to the change\n      if (viewSnapshot) {\n        restoreView(editor.current!, viewSnapshot)\n      } else {\n        const startLine = revertedChange.modifiedStartLineNumber\n        startLine !== undefined && navigateTo(editor.current!, startLine)\n      }\n    }\n\n    return () => {\n      const { current } = editor\n      const currentModel = current?.getModel()\n\n      // Detach only if the editor still uses the models created by this render\n      if (\n        current &&\n        currentModel &&\n        currentModel.original === originalModel &&\n        currentModel.modified === modifiedModel\n      ) {\n        try {\n          current.setModel(null)\n        } catch (_) {\n          // editor may have been disposed concurrently; ignore\n        }\n      }\n\n      originalModel.dispose()\n      modifiedModel.dispose()\n    }\n  }, [editor, before, after, language, type, revertedChange, viewSnapshot])\n\n  useAddLineControls(editor, setRevertedChange, setViewSnapshot)\n\n  useEffect(() => {\n    const content = editor.current?.getModel()?.modified.getValue()\n    if (content && selectedUri) {\n      const location = findPathLocation(content, selectedUri)\n      const startLine = location?.range.start.line\n      startLine !== undefined && navigateTo(editor.current!, startLine + 1)\n    }\n  }, [selectedUri])\n\n  return ref\n}\n\nfunction navigateTo(\n  editor: Editor.IStandaloneDiffEditor,\n  lineNumber: number,\n): void {\n  const modifiedEditor = editor.getModifiedEditor()\n\n  // Keep navigation resilient during a short stabilization window\n  const stabilizeMs = 300\n  const endTime = Date.now() + stabilizeMs\n  let lastApply = 0\n  const applyIntervalMs = 30\n  const applyNavigate = (): void => {\n    const now = Date.now()\n    if (now - lastApply < applyIntervalMs) return\n    lastApply = now\n    const targetRange = new Range(lineNumber, 1, lineNumber, 1)\n    modifiedEditor.revealRangeNearTop(targetRange, Editor.ScrollType.Smooth)\n    modifiedEditor.setSelection(targetRange)\n    modifiedEditor.focus()\n  }\n\n  // Try immediately if models are ready\n  const model = modifiedEditor.getModel()\n  if (model) {\n    // Schedule to the next frame to wait for layout after model swap\n    requestAnimationFrame(() => {\n      applyNavigate()\n    })\n  }\n\n  // Also listen for diff update/layout as a robust fallback (fires after model attach/layout)\n  const disposables: { dispose: () => void }[] = []\n  const disposeAll = (): void => {\n    disposables.forEach(d => {\n      try {\n        d.dispose()\n      } catch (_) {\n        // ignore\n      }\n    })\n  }\n\n  disposables.push(\n    editor.onDidUpdateDiff(() => {\n      applyNavigate()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  disposables.push(\n    modifiedEditor.onDidLayoutChange(() => {\n      applyNavigate()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  // Also react to unexpected scroll resets during stabilization\n  disposables.push(\n    modifiedEditor.onDidScrollChange(() => {\n      applyNavigate()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  // Final timer-based fallback in case neither event fires (e.g., no diff)\n  setTimeout(() => {\n    applyNavigate()\n    if (Date.now() > endTime) disposeAll()\n  }, 50)\n\n  // Robustness: retry a few times until the line is actually visible\n  let attemptsRemaining = 3\n  const tryEnsureVisible = (): void => {\n    const ranges = modifiedEditor.getVisibleRanges()\n    const isVisible = ranges.some(r => r.startLineNumber <= lineNumber && r.endLineNumber >= lineNumber)\n    const scrolled = modifiedEditor.getScrollTop() > 0 || lineNumber === 1\n    if (isVisible || scrolled || attemptsRemaining <= 0) return\n    attemptsRemaining -= 1\n    setTimeout(() => {\n      const targetRange = new Range(lineNumber, 1, lineNumber, 1)\n      modifiedEditor.revealRangeNearTop(targetRange, Editor.ScrollType.Smooth)\n      requestAnimationFrame(tryEnsureVisible)\n    }, 60)\n  }\n  requestAnimationFrame(tryEnsureVisible)\n}\n\nfunction restoreView(\n  editor: Editor.IStandaloneDiffEditor,\n  snapshot: { scrollTop: number; firstVisibleLine?: number },\n): void {\n  const modifiedEditor = editor.getModifiedEditor()\n\n  const stabilizeMs = 300\n  const endTime = Date.now() + stabilizeMs\n  let lastApply = 0\n  const applyIntervalMs = 30\n\n  const applyRestore = (): void => {\n    const now = Date.now()\n    if (now - lastApply < applyIntervalMs) return\n    lastApply = now\n    // Directly restore the exact scroll position\n    modifiedEditor.setScrollTop(snapshot.scrollTop, Editor.ScrollType.Immediate)\n  }\n\n  const disposables: { dispose: () => void }[] = []\n  const disposeAll = (): void => {\n    disposables.forEach(d => {\n      try {\n        d.dispose()\n      } catch (_) {\n        // ignore\n      }\n    })\n  }\n\n  requestAnimationFrame(applyRestore)\n\n  disposables.push(\n    editor.onDidUpdateDiff(() => {\n      applyRestore()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n  disposables.push(\n    modifiedEditor.onDidLayoutChange(() => {\n      applyRestore()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n  disposables.push(\n    modifiedEditor.onDidScrollChange(() => {\n      // Keep the previous viewport during stabilization\n      applyRestore()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  setTimeout(() => {\n    applyRestore()\n    if (Date.now() > endTime) disposeAll()\n  }, 50)\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'monaco-editor/esm/vs/editor/editor.all.js'\nimport 'monaco-editor/esm/vs/language/json/monaco.contribution'\nimport 'monaco-editor/esm/vs/basic-languages/yaml/yaml.contribution'\nimport 'monaco-editor/esm/vs/basic-languages/markdown/markdown.contribution'\n\nimport type { FC } from 'react'\nimport { memo } from 'react'\nimport { useMonacoDiffEditorElement } from './useMonacoDiffEditorElement'\nimport type { SpecType } from '../../utils/specs'\nimport type { LanguageType } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\n\nexport type MonacoDiffEditorElementProps = {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n}\n\nconst MonacoDiffEditorElement: FC<MonacoDiffEditorElementProps> = memo<MonacoDiffEditorElementProps>(({\n  before,\n  after,\n  type,\n  language,\n  selectedUri,\n}) => {\n  const element = useMonacoDiffEditorElement({ before, after, type, language, selectedUri })\n\n  return (\n    <div\n      ref={element}\n      style={{ height: '100%' }}\n    />\n  )\n})\n\nexport default MonacoDiffEditorElement\n"],"names":["getDefaultState","MutationObserver","Subscribable","client","options","prevOptions","shallowEqualObjects","_this$currentMutation","action","notifyOptions","variables","state","result","notifyManager","_this$mutateOptions$o","_this$mutateOptions","_this$mutateOptions$o2","_this$mutateOptions2","_this$mutateOptions$o3","_this$mutateOptions3","_this$mutateOptions$o4","_this$mutateOptions4","listener","useMutation","arg1","arg2","arg3","parseMutationArgs","queryClient","useQueryClient","observer","React.useState","React.useEffect","useSyncExternalStore","React.useCallback","onStoreChange","mutate","mutateOptions","noop","shouldThrowError","QUERY_KEY_AI_ENHANCED_DOCUMENT_RAW_CONTENT","useInvalidateAiEnhancedDocumentRawContent","useRevertChangeInEnhancedDocument","invalidateAiEnhancedDocumentRawContent","isReverting","request","revert","packageId","version","slug","content","packageKey","versionKey","documentKey","endpoint","generatePath","requestJson","STUB_API_V1","RawDiffTypes","useAddLineControls","editor","setRevertedChange","setViewSnapshot","versionId","documentId","useParams","widgetsRef","useRef","modelIdRef","disposableRef","useEffect","diffEditor","modifiedEditor","model","currentModelId","widget","addLineControls","lineChanges","widgets","change","modifiedStartLineNumber","modifiedEndLineNumber","diffType","detectDiffType","lineNumber","button","e","currentRanges","firstVisibleLine","_a","scrollTop","originalValue","_b","modifiedValue","_c","revertedValue","revertChange","range","Range","Editor","originalLines","modifiedLines","pickedOriginalLines","updatedModifiedLines","_","index","originalStartLineNumber","originalEndLineNumber","modifiedRange","originalRange","useMonacoDiffEditorElement","before","after","type","language","LANGUAGE_TYPE_TEXT","selectedUri","ref","revertedChange","useState","viewSnapshot","useEffectOnce","previousScrollTop","originalModel","modifiedModel","restoreView","startLine","navigateTo","current","currentModel","location","findPathLocation","stabilizeMs","endTime","lastApply","applyIntervalMs","applyNavigate","now","targetRange","disposables","disposeAll","d","attemptsRemaining","tryEnsureVisible","isVisible","r","scrolled","snapshot","applyRestore","MonacoDiffEditorElement","memo","element","jsx"],"mappings":"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","x_google_ignoreList":[0,1,2]}