import{j as z}from"./createTheme-d4c6d141.js";import{R as T,e as y}from"./toggleHighContrast-761813bf.js";import{r as g}from"./index-37ba2b57.js";import{f as K,L as B}from"./graphql-samples-79dbe107.js";import{e as Q}from"./index-6b7f7c95.js";import{S as J,s as X,n as F,p as Y,u as P,a as H,b as Z,r as $,c as ee}from"./utils-91def6e8.js";import{b as te}from"./router-3bda5a86.js";import{u as ne}from"./useEffectOnce-12abbac4.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-9c75dc50.js";import"./iframe-4c827c96.js";import"../sb-preview/runtime.js";import"./_commonjsHelpers-de833af9.js";import"./files-221a97f0.js";import"./apihub-builder.es-a0fb97bd.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./strings-8f296fda.js";import"./dialogTitleClasses-c8d9dbc5.js";import"./clsx.m-6cf3b989.js";import"./ClassNameGenerator-bd600f10.js";import"./useThemeProps-90078124.js";import"./useTheme-0ad13214.js";import"./Modal-9f2c2b11.js";import"./utils-0c060528.js";import"./inheritsLoose-5494d9cc.js";import"./index-4da2af8c.js";import"./TransitionGroupContext-f40e0036.js";import"./useEnhancedEffect-9d60ea74.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-03d1c82d.js";import"./createChainedFunction-0bab83cf.js";import"./Portal-fc00eb8c.js";import"./isHostComponent-73d6e646.js";import"./Paper-dca8f967.js";import"./useId-f6e37502.js";import"./DialogTitle-cd1b99ce.js";import"./Typography-d1555f73.js";import"./extendSxProp-acc1143e.js";import"./DialogContent-fd001b96.js";import"./DialogContentText-f02e7458.js";import"./Button-7fbb2719.js";import"./ButtonBase-1b5192e9.js";import"./emotion-react.browser.esm-f969ea94.js";import"./assertThisInitialized-081f9914.js";import"./createSvgIcon-473ccb66.js";import"./constants-e3f42350.js";import"./index-2374ef69.js";function re(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class ie extends J{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.client.defaultMutationOptions(t),X(e,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this})}onUnsubscribe(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:re(),e={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=e}notify(t){F.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var e,s,i,r;(e=(s=this.mutateOptions).onSuccess)==null||e.call(s,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(i=(r=this.mutateOptions).onSettled)==null||i.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var o,n,u,c;(o=(n=this.mutateOptions).onError)==null||o.call(n,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(u=(c=this.mutateOptions).onSettled)==null||u.call(c,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(l=>{l(this.currentResult)})})}}function oe(a,t,e){const s=Y(a,t,e),i=P({context:s.context}),[r]=g.useState(()=>new ie(i,s));g.useEffect(()=>{r.setOptions(s)},[r,s]);const o=H(g.useCallback(u=>r.subscribe(F.batchCalls(u)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),n=g.useCallback((u,c)=>{r.mutate(u,c).catch(se)},[r]);if(o.error&&Z(r.options.useErrorBoundary,[o.error]))throw o.error;return{...o,mutate:n,mutateAsync:o.mutate}}function se(){}function ae(){const a=P(),{mutate:t,isLoading:e}=oe({mutationFn:s=>ue(s),onSuccess:async()=>{await a.invalidateQueries({queryKey:["ai-enhanced-document-raw-content"]})}});return{mutate:t,isReverting:e}}function ue(a){const{packageId:t,version:e,slug:s,content:i}=a,r=encodeURIComponent(t),o=encodeURIComponent(e),n=encodeURIComponent(s),c=te("/packages/:packageId/versions/:versionId/enhancedFiles/:documentId/raw",{packageId:r,versionId:o,documentId:n});return $(c,{method:"PUT",body:i},{basePath:ee})}const R={add:"add",remove:"remove",change:"change"};function ce(a,t,e){const{packageId:s,versionId:i,documentId:r}=Q(),{mutate:o}=ae(),n=g.useRef([]),u=g.useRef(null),c=g.useRef(null);g.useEffect(()=>{if(!a.current)return;const l=a.current,b=l.getModifiedEditor(),p=l.getModel();if(!p)return;const f=p.modified.uri.toString();if(u.current===f)return;u.current=f,c.current&&c.current.dispose(),n.current.forEach(d=>{b.removeGlyphMarginWidget(d)}),n.current=[];const v=()=>{n.current.forEach(m=>{b.removeGlyphMarginWidget(m)});const d=l.getLineChanges();if(!d)return;const L=[];d.forEach(m=>{const{modifiedStartLineNumber:S,modifiedEndLineNumber:w}=m,j=_(m);for(let M=S;M<=w;M++){const D=document.createElement("button");D.textContent="â†’",D.style.cssText="cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;",D.onclick=N=>{var q,U,A;N.preventDefault(),N.stopPropagation();try{const E=b.getVisibleRanges(),G=(q=E==null?void 0:E[0])==null?void 0:q.startLineNumber,W=b.getScrollTop();e==null||e({scrollTop:W,firstVisibleLine:G})}catch{}const x=(U=l.getModel())==null?void 0:U.original.getValue(),k=(A=l.getModel())==null?void 0:A.modified.getValue();if(x&&k){const E=le(x,k,m);o({packageId:s??"",version:i??"",slug:r??"",content:E}),t(m)}};let C;j===R.add?(C=new T(M,1,w,1),M+=w-M+1):C=new T(M,1,M,1);const I={getId:()=>`line-control-${M}`,getDomNode:()=>D,getPosition:()=>({lane:y.GlyphMarginLane.Right,zIndex:10,range:C})};b.addGlyphMarginWidget(I),L.push(I)}}),n.current=L};return v(),c.current=l.onDidUpdateDiff(()=>{v()}),()=>{var d;(d=c.current)==null||d.dispose()}},[r,a,s,o,t,e,i])}function le(a,t,e){const s=a.split(`
`),i=t.split(`
`),r=_(e);if(r===R.remove){const o=s.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),n=[...i];return n.splice(e.modifiedStartLineNumber-1,0,...o),n.join(`
`)}if(r===R.change){const o=s.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),n=[...i];return n.splice(e.modifiedStartLineNumber-1,o.length,...o),n.join(`
`)}return r===R.add?i.filter((n,u)=>u<e.modifiedStartLineNumber-1||u>e.modifiedEndLineNumber-1).join(`
`):""}function _(a){const{originalStartLineNumber:t,originalEndLineNumber:e,modifiedStartLineNumber:s,modifiedEndLineNumber:i}=a,r=i-s,o=e-t;return r===o?R.change:r>o?R.add:R.remove}function de(a){const{before:t,after:e,type:s,language:i=B,selectedUri:r}=a,o=g.useRef(null),n=g.useRef(),[u,c]=g.useState(void 0),[l,b]=g.useState(void 0);return ne(()=>(y.defineTheme("custom",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#FFFFFF"}}),n.current=y.createDiffEditor(o.current,{minimap:{enabled:!0},hover:{above:!1},automaticLayout:!0,readOnly:!0,wordWrap:"on",glyphMargin:!0,theme:"custom"}),()=>{var p,f;try{(p=n.current)==null||p.setModel(null)}catch{}(f=n.current)==null||f.dispose(),n.current=void 0})),g.useEffect(()=>{var d,L;const p=(d=n.current)==null?void 0:d.getModifiedEditor(),f=(p==null?void 0:p.getScrollTop())??0,h=y.createModel(t,i),v=y.createModel(e,i);if((L=n.current)==null||L.setModel({original:h,modified:v}),p&&f>0&&p.setScrollTop(f,y.ScrollType.Immediate),u)if(l)pe(n.current,l);else{const m=u.modifiedStartLineNumber;m!==void 0&&O(n.current,m)}return()=>{const{current:m}=n,S=m==null?void 0:m.getModel();if(m&&S&&S.original===h&&S.modified===v)try{m.setModel(null)}catch{}h.dispose(),v.dispose()}},[n,t,e,i,s,u,l]),ce(n,c,b),g.useEffect(()=>{var f,h;const p=(h=(f=n.current)==null?void 0:f.getModel())==null?void 0:h.modified.getValue();if(p&&r){const v=K(p,r),d=v==null?void 0:v.range.start.line;d!==void 0&&O(n.current,d+1)}},[r]),o}function O(a,t){const e=a.getModifiedEditor(),s=300,i=Date.now()+s;let r=0;const o=30,n=()=>{const f=Date.now();if(f-r<o)return;r=f;const h=new T(t,1,t,1);e.revealRangeNearTop(h,y.ScrollType.Smooth),e.setSelection(h),e.focus()};e.getModel()&&requestAnimationFrame(()=>{n()});const c=[],l=()=>{c.forEach(f=>{try{f.dispose()}catch{}})};c.push(a.onDidUpdateDiff(()=>{n(),Date.now()>i&&l()})),c.push(e.onDidLayoutChange(()=>{n(),Date.now()>i&&l()})),c.push(e.onDidScrollChange(()=>{n(),Date.now()>i&&l()})),setTimeout(()=>{n(),Date.now()>i&&l()},50);let b=3;const p=()=>{const h=e.getVisibleRanges().some(d=>d.startLineNumber<=t&&d.endLineNumber>=t),v=e.getScrollTop()>0||t===1;h||v||b<=0||(b-=1,setTimeout(()=>{const d=new T(t,1,t,1);e.revealRangeNearTop(d,y.ScrollType.Smooth),requestAnimationFrame(p)},60))};requestAnimationFrame(p)}function pe(a,t){const e=a.getModifiedEditor(),s=300,i=Date.now()+s;let r=0;const o=30,n=()=>{const l=Date.now();l-r<o||(r=l,e.setScrollTop(t.scrollTop,y.ScrollType.Immediate))},u=[],c=()=>{u.forEach(l=>{try{l.dispose()}catch{}})};requestAnimationFrame(n),u.push(a.onDidUpdateDiff(()=>{n(),Date.now()>i&&c()})),u.push(e.onDidLayoutChange(()=>{n(),Date.now()>i&&c()})),u.push(e.onDidScrollChange(()=>{n(),Date.now()>i&&c()})),setTimeout(()=>{n(),Date.now()>i&&c()},50)}const V=g.memo(({before:a,after:t,type:e,language:s,selectedUri:i})=>{const r=de({before:a,after:t,type:e,language:s,selectedUri:i});return z("div",{ref:r,style:{height:"100%"}})});try{V.displayName="MonacoDiffEditorElement",V.__docgenInfo={description:"",displayName:"MonacoDiffEditorElement",props:{before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"string"}},after:{defaultValue:null,description:"",name:"after",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"graphql"'},{value:'"openapi-3-1"'},{value:'"openapi-3-0"'},{value:'"openapi-2-0"'},{value:'"openapi"'},{value:'"asyncapi-2"'},{value:'"json-schema"'},{value:'"markdown"'},{value:'"unknown"'},{value:'"graphql-schema"'},{value:'"graphapi"'},{value:'"introspection"'},{value:'"protobuf-3"'}]}},language:{defaultValue:null,description:"",name:"language",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"graphql"'},{value:'"markdown"'},{value:'"yaml"'},{value:'"json"'},{value:'"proto"'}]}},selectedUri:{defaultValue:null,description:"",name:"selectedUri",required:!1,type:{name:"`/${string}`"}}}}}catch{}export{V as default};
//# sourceMappingURL=MonacoDiffEditorElement-37a16299.js.map
