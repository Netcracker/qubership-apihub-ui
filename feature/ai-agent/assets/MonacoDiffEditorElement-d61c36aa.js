import{j as P}from"./createTheme-d4c6d141.js";import{R,e as L}from"./toggleHighContrast-0b93fb07.js";import{r as y}from"./index-37ba2b57.js";import{f as z,L as O}from"./graphql-samples-79dbe107.js";import{e as X}from"./index-6b7f7c95.js";import{u as Y}from"./useEffectOnce-12abbac4.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-9c75dc50.js";import"./iframe-48ca7af7.js";import"../sb-preview/runtime.js";import"./_commonjsHelpers-de833af9.js";import"./files-221a97f0.js";import"./apihub-builder.es-a0fb97bd.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./strings-8f296fda.js";import"./dialogTitleClasses-c8d9dbc5.js";import"./clsx.m-6cf3b989.js";import"./ClassNameGenerator-bd600f10.js";import"./useThemeProps-90078124.js";import"./useTheme-0ad13214.js";import"./Modal-9f2c2b11.js";import"./utils-0c060528.js";import"./inheritsLoose-5494d9cc.js";import"./index-4da2af8c.js";import"./TransitionGroupContext-f40e0036.js";import"./useEnhancedEffect-9d60ea74.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-03d1c82d.js";import"./createChainedFunction-0bab83cf.js";import"./Portal-fc00eb8c.js";import"./isHostComponent-73d6e646.js";import"./Paper-dca8f967.js";import"./useId-f6e37502.js";import"./DialogTitle-cd1b99ce.js";import"./Typography-d1555f73.js";import"./extendSxProp-acc1143e.js";import"./DialogContent-fd001b96.js";import"./DialogContentText-f02e7458.js";import"./Button-7fbb2719.js";import"./ButtonBase-1b5192e9.js";import"./emotion-react.browser.esm-f969ea94.js";import"./assertThisInitialized-081f9914.js";import"./createSvgIcon-473ccb66.js";import"./router-3bda5a86.js";const T={add:"add",remove:"remove",change:"change"};function B(l,n,e,p){const{packageId:i,versionId:r,documentId:d}=X(),t=y.useRef([]),o=y.useRef(null),c=y.useRef(null);y.useEffect(()=>{if(!l.current)return;const u=l.current,f=u.getModifiedEditor(),b=u.getModel();if(!b)return;const a=b.modified.uri.toString();if(o.current===a)return;o.current=a,c.current&&c.current.dispose(),t.current.forEach(s=>{f.removeGlyphMarginWidget(s)}),t.current=[];const g=()=>{t.current.forEach(h=>{f.removeGlyphMarginWidget(h)});const s=u.getLineChanges();if(!s)return;const E=[];s.forEach(h=>{const{modifiedStartLineNumber:v,modifiedEndLineNumber:D}=h,q=j(h);for(let M=v;M<=D;M++){const S=document.createElement("button");S.textContent="â†’",S.style.cssText="cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;",S.onclick=I=>{var C,k,F;I.preventDefault(),I.stopPropagation();try{const w=f.getVisibleRanges(),W=(C=w==null?void 0:w[0])==null?void 0:C.startLineNumber,G=f.getScrollTop();e==null||e({scrollTop:G,firstVisibleLine:W})}catch{}const V=(k=u.getModel())==null?void 0:k.original.getValue(),A=(F=u.getModel())==null?void 0:F.modified.getValue();if(V&&A){const w=H(V,A,h);p==null||p({packageId:i??"",version:r??"",slug:d??"",content:w}),n(h)}};let N;q===T.add?(N=new R(M,1,D,1),M+=D-M+1):N=new R(M,1,M,1);const _={getId:()=>`line-control-${M}`,getDomNode:()=>S,getPosition:()=>({lane:L.GlyphMarginLane.Right,zIndex:10,range:N})};f.addGlyphMarginWidget(_),E.push(_)}}),t.current=E};return g(),c.current=u.onDidUpdateDiff(()=>{g()}),()=>{var s;(s=c.current)==null||s.dispose()}},[d,l,i,p,n,e,r])}function H(l,n,e){const p=l.split(`
`),i=n.split(`
`),r=j(e);if(r===T.remove){const d=p.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),t=[...i];return t.splice(e.modifiedStartLineNumber-1,0,...d),t.join(`
`)}if(r===T.change){const d=p.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),t=[...i];return t.splice(e.modifiedStartLineNumber-1,d.length,...d),t.join(`
`)}return r===T.add?i.filter((t,o)=>o<e.modifiedStartLineNumber-1||o>e.modifiedEndLineNumber-1).join(`
`):""}function j(l){const{originalStartLineNumber:n,originalEndLineNumber:e,modifiedStartLineNumber:p,modifiedEndLineNumber:i}=l,r=i-p,d=e-n;return r===d?T.change:r>d?T.add:T.remove}function J(l){const{before:n,after:e,type:p,language:i=O,selectedUri:r,requestRevertChange:d}=l,t=y.useRef(null),o=y.useRef(),[c,u]=y.useState(void 0),[f,b]=y.useState(void 0);return Y(()=>(L.defineTheme("custom",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#FFFFFF"}}),o.current=L.createDiffEditor(t.current,{minimap:{enabled:!0},hover:{above:!1},automaticLayout:!0,readOnly:!0,wordWrap:"on",glyphMargin:!0,theme:"custom"}),()=>{var a,m;try{(a=o.current)==null||a.setModel(null)}catch{}(m=o.current)==null||m.dispose(),o.current=void 0})),y.useEffect(()=>{var E,h;const a=(E=o.current)==null?void 0:E.getModifiedEditor(),m=(a==null?void 0:a.getScrollTop())??0,g=L.createModel(n,i),s=L.createModel(e,i);if((h=o.current)==null||h.setModel({original:g,modified:s}),a&&m>0&&a.setScrollTop(m,L.ScrollType.Immediate),c)if(f)K(o.current,f);else{const v=c.modifiedStartLineNumber;v!==void 0&&x(o.current,v)}return()=>{const{current:v}=o,D=v==null?void 0:v.getModel();if(v&&D&&D.original===g&&D.modified===s)try{v.setModel(null)}catch{}g.dispose(),s.dispose()}},[o,n,e,i,p,c,f]),B(o,u,b,d),y.useEffect(()=>{var m,g;const a=(g=(m=o.current)==null?void 0:m.getModel())==null?void 0:g.modified.getValue();if(a&&r){const s=z(a,r),E=s==null?void 0:s.range.start.line;E!==void 0&&x(o.current,E+1)}},[r]),t}function x(l,n){const e=l.getModifiedEditor(),p=300,i=Date.now()+p;let r=0;const d=30,t=()=>{const a=Date.now();if(a-r<d)return;r=a;const m=new R(n,1,n,1);e.revealRangeNearTop(m,L.ScrollType.Smooth),e.setSelection(m),e.focus()};e.getModel()&&requestAnimationFrame(()=>{t()});const c=[],u=()=>{c.forEach(a=>{try{a.dispose()}catch{}})};c.push(l.onDidUpdateDiff(()=>{t(),Date.now()>i&&u()})),c.push(e.onDidLayoutChange(()=>{t(),Date.now()>i&&u()})),c.push(e.onDidScrollChange(()=>{t(),Date.now()>i&&u()})),setTimeout(()=>{t(),Date.now()>i&&u()},50);let f=3;const b=()=>{const m=e.getVisibleRanges().some(s=>s.startLineNumber<=n&&s.endLineNumber>=n),g=e.getScrollTop()>0||n===1;m||g||f<=0||(f-=1,setTimeout(()=>{const s=new R(n,1,n,1);e.revealRangeNearTop(s,L.ScrollType.Smooth),requestAnimationFrame(b)},60))};requestAnimationFrame(b)}function K(l,n){const e=l.getModifiedEditor(),p=300,i=Date.now()+p;let r=0;const d=30,t=()=>{const u=Date.now();u-r<d||(r=u,e.setScrollTop(n.scrollTop,L.ScrollType.Immediate))},o=[],c=()=>{o.forEach(u=>{try{u.dispose()}catch{}})};requestAnimationFrame(t),o.push(l.onDidUpdateDiff(()=>{t(),Date.now()>i&&c()})),o.push(e.onDidLayoutChange(()=>{t(),Date.now()>i&&c()})),o.push(e.onDidScrollChange(()=>{t(),Date.now()>i&&c()})),setTimeout(()=>{t(),Date.now()>i&&c()},50)}const U=y.memo(l=>{const{before:n,after:e,type:p,language:i,selectedUri:r,requestRevertChange:d}=l,t=J({before:n,after:e,type:p,language:i,selectedUri:r,requestRevertChange:d});return P("div",{ref:t,style:{height:"100%"}})});try{U.displayName="MonacoDiffEditorElement",U.__docgenInfo={description:"",displayName:"MonacoDiffEditorElement",props:{before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"string"}},after:{defaultValue:null,description:"",name:"after",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"graphql"'},{value:'"openapi-3-1"'},{value:'"openapi-3-0"'},{value:'"openapi-2-0"'},{value:'"openapi"'},{value:'"asyncapi-2"'},{value:'"json-schema"'},{value:'"markdown"'},{value:'"unknown"'},{value:'"graphql-schema"'},{value:'"graphapi"'},{value:'"introspection"'},{value:'"protobuf-3"'}]}},language:{defaultValue:null,description:"",name:"language",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"graphql"'},{value:'"markdown"'},{value:'"yaml"'},{value:'"json"'},{value:'"proto"'}]}},selectedUri:{defaultValue:null,description:"",name:"selectedUri",required:!1,type:{name:"`/${string}`"}},requestRevertChange:{defaultValue:null,description:"",name:"requestRevertChange",required:!1,type:{name:"RevertChangeInAiEnhancedPackageVersionMutationFn"}}}}}catch{}export{U as default};
//# sourceMappingURL=MonacoDiffEditorElement-d61c36aa.js.map
