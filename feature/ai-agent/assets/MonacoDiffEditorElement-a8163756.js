import{j as _}from"./createTheme-d4c6d141.js";import{R as L,e as b}from"./toggleHighContrast-e9546319.js";import{r as m}from"./index-37ba2b57.js";import{f as G,L as W}from"./graphql-samples-79dbe107.js";import{e as K}from"./index-6b7f7c95.js";import{S as z,s as B,n as U,p as Q,u as V,a as H,b as J,r as X}from"./utils-afdb0ff1.js";import{b as Y}from"./router-3bda5a86.js";import{u as Z}from"./useEffectOnce-12abbac4.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-9c75dc50.js";import"./iframe-b5484379.js";import"../sb-preview/runtime.js";import"./_commonjsHelpers-de833af9.js";import"./files-221a97f0.js";import"./apihub-builder.es-a0fb97bd.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./strings-8f296fda.js";import"./dialogTitleClasses-c8d9dbc5.js";import"./clsx.m-6cf3b989.js";import"./ClassNameGenerator-bd600f10.js";import"./useThemeProps-90078124.js";import"./useTheme-0ad13214.js";import"./Modal-9f2c2b11.js";import"./utils-0c060528.js";import"./inheritsLoose-5494d9cc.js";import"./index-4da2af8c.js";import"./TransitionGroupContext-f40e0036.js";import"./useEnhancedEffect-9d60ea74.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-03d1c82d.js";import"./createChainedFunction-0bab83cf.js";import"./Portal-fc00eb8c.js";import"./isHostComponent-73d6e646.js";import"./Paper-dca8f967.js";import"./useId-f6e37502.js";import"./DialogTitle-cd1b99ce.js";import"./Typography-d1555f73.js";import"./extendSxProp-acc1143e.js";import"./DialogContent-fd001b96.js";import"./DialogContentText-f02e7458.js";import"./Button-7fbb2719.js";import"./ButtonBase-1b5192e9.js";import"./emotion-react.browser.esm-f969ea94.js";import"./assertThisInitialized-081f9914.js";import"./createSvgIcon-473ccb66.js";import"./constants-e3f42350.js";import"./index-2374ef69.js";function $(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class ee extends z{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.client.defaultMutationOptions(t),B(e,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this})}onUnsubscribe(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:$(),e={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=e}notify(t){U.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var e,o,i,r;(e=(o=this.mutateOptions).onSuccess)==null||e.call(o,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(i=(r=this.mutateOptions).onSettled)==null||i.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var s,n,d,l;(s=(n=this.mutateOptions).onError)==null||s.call(n,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(d=(l=this.mutateOptions).onSettled)==null||d.call(l,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(a=>{a(this.currentResult)})})}}function te(u,t,e){const o=Q(u,t,e),i=V({context:o.context}),[r]=m.useState(()=>new ee(i,o));m.useEffect(()=>{r.setOptions(o)},[r,o]);const s=H(m.useCallback(d=>r.subscribe(U.batchCalls(d)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),n=m.useCallback((d,l)=>{r.mutate(d,l).catch(ne)},[r]);if(s.error&&J(r.options.useErrorBoundary,[s.error]))throw s.error;return{...s,mutate:n,mutateAsync:s.mutate}}function ne(){}const re="/stub/api/v1";function ie(){const u=V(),{mutate:t,isLoading:e}=te({mutationFn:o=>oe(o),onSuccess:async()=>{await u.invalidateQueries({queryKey:["ai-enhanced-document-raw-content"]})}});return{mutate:t,isReverting:e}}function oe(u){const{packageId:t,version:e,slug:o,content:i}=u,r=encodeURIComponent(t),s=encodeURIComponent(e),n=encodeURIComponent(o),l=Y("/packages/:packageId/versions/:versionId/enhancedFiles/:documentId/raw",{packageId:r,versionId:s,documentId:n});return X(l,{method:"PUT",body:i},{basePath:re})}const y={add:"add",remove:"remove",change:"change"};function se(u,t){const{packageId:e,versionId:o,documentId:i}=K(),{mutate:r,isReverting:s}=ie(),n=m.useRef([]),d=m.useRef(null),l=m.useRef(null);m.useEffect(()=>{if(!u.current)return;const a=u.current,p=a.getModifiedEditor(),g=a.getModel();if(!g)return;const c=g.modified.uri.toString();if(d.current===c)return;d.current=c,l.current&&l.current.dispose(),n.current.forEach(h=>{p.removeGlyphMarginWidget(h)}),n.current=[];const R=()=>{n.current.forEach(M=>{p.removeGlyphMarginWidget(M)});const h=a.getLineChanges();if(!h)return;const C=[];h.forEach(M=>{const{modifiedStartLineNumber:A,modifiedEndLineNumber:S}=M,F=P(M);for(let v=A;v<=S;v++){const E=document.createElement("button");E.textContent="â†’",E.style.cssText="cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;",E.onclick=I=>{var x,k;I.preventDefault(),I.stopPropagation();const T=(x=a.getModel())==null?void 0:x.original.getValue(),N=(k=a.getModel())==null?void 0:k.modified.getValue();if(T&&N){const j=ae(T,N,M);r({packageId:e??"",version:o??"",slug:i??"",content:j}),t(M)}};let w;F===y.add?(w=new L(v,1,S,1),v+=S-v+1):w=new L(v,1,v,1);const D={getId:()=>`line-control-${v}`,getDomNode:()=>E,getPosition:()=>({lane:b.GlyphMarginLane.Right,zIndex:10,range:w})};p.addGlyphMarginWidget(D),C.push(D)}}),n.current=C};return R(),l.current=a.onDidUpdateDiff(()=>{R()}),()=>{var h;(h=l.current)==null||h.dispose()}},[i,u,e,r,o])}function ae(u,t,e){const o=u.split(`
`),i=t.split(`
`),r=P(e);if(r===y.remove){const s=o.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),n=[...i];return n.splice(e.modifiedStartLineNumber-1,0,...s),n.join(`
`)}if(r===y.change){const s=o.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),n=[...i];return n.splice(e.modifiedStartLineNumber-1,s.length,...s),n.join(`
`)}return r===y.add?i.filter((n,d)=>d<e.modifiedStartLineNumber-1||d>e.modifiedEndLineNumber-1).join(`
`):""}function P(u){const{originalStartLineNumber:t,originalEndLineNumber:e,modifiedStartLineNumber:o,modifiedEndLineNumber:i}=u,r=i-o,s=e-t;return r===s?y.change:r>s?y.add:y.remove}function ue(u){const{before:t,after:e,type:o,language:i=W,selectedUri:r}=u,s=m.useRef(null),n=m.useRef(),[d,l]=m.useState(void 0);return Z(()=>(b.defineTheme("custom",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#FFFFFF"}}),n.current=b.createDiffEditor(s.current,{minimap:{enabled:!0},hover:{above:!1},automaticLayout:!0,readOnly:!0,wordWrap:"on",glyphMargin:!0,theme:"custom"}),()=>{var a,p;try{(a=n.current)==null||a.setModel(null)}catch{}(p=n.current)==null||p.dispose(),n.current=void 0})),m.useEffect(()=>{var g;const a=b.createModel(t,i),p=b.createModel(e,i);if((g=n.current)==null||g.setModel({original:a,modified:p}),d){const c=d.modifiedStartLineNumber;c!==void 0&&q(n.current,c)}return()=>{const{current:c}=n,f=c==null?void 0:c.getModel();if(c&&f&&f.original===a&&f.modified===p)try{c.setModel(null)}catch{}a.dispose(),p.dispose()}},[n,t,e,i,o,d]),se(n,l),m.useEffect(()=>{var p,g;const a=(g=(p=n.current)==null?void 0:p.getModel())==null?void 0:g.modified.getValue();if(a&&r){const c=G(a,r),f=c==null?void 0:c.range.start.line;f!==void 0&&q(n.current,f+1)}},[r]),s}function q(u,t){const e=u.getModifiedEditor(),o=300,i=Date.now()+o;let r=0;const s=30,n=()=>{const c=Date.now();if(c-r<s)return;r=c;const f=new L(t,1,t,1);e.revealRangeNearTop(f,b.ScrollType.Smooth),e.setSelection(f),e.focus()};e.getModel()&&requestAnimationFrame(()=>{n()});const l=[],a=()=>{l.forEach(c=>{try{c.dispose()}catch{}})};l.push(u.onDidUpdateDiff(()=>{n(),Date.now()>i&&a()})),l.push(e.onDidLayoutChange(()=>{n(),Date.now()>i&&a()})),l.push(e.onDidScrollChange(()=>{n(),Date.now()>i&&a()})),setTimeout(()=>{n(),Date.now()>i&&a()},50);let p=3;const g=()=>{const f=e.getVisibleRanges().some(h=>h.startLineNumber<=t&&h.endLineNumber>=t),R=e.getScrollTop()>0||t===1;f||R||p<=0||(p-=1,setTimeout(()=>{const h=new L(t,1,t,1);e.revealRangeNearTop(h,b.ScrollType.Smooth),requestAnimationFrame(g)},60))};requestAnimationFrame(g)}const O=m.memo(({before:u,after:t,type:e,language:o,selectedUri:i})=>{const r=ue({before:u,after:t,type:e,language:o,selectedUri:i});return _("div",{ref:r,style:{height:"100%"}})});try{O.displayName="MonacoDiffEditorElement",O.__docgenInfo={description:"",displayName:"MonacoDiffEditorElement",props:{before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"string"}},after:{defaultValue:null,description:"",name:"after",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"graphql"'},{value:'"openapi-3-1"'},{value:'"openapi-3-0"'},{value:'"openapi-2-0"'},{value:'"openapi"'},{value:'"asyncapi-2"'},{value:'"json-schema"'},{value:'"markdown"'},{value:'"unknown"'},{value:'"graphql-schema"'},{value:'"graphapi"'},{value:'"introspection"'},{value:'"protobuf-3"'}]}},language:{defaultValue:null,description:"",name:"language",required:!1,type:{name:"enum",value:[{value:'"graphql"'},{value:'"text"'},{value:'"markdown"'},{value:'"yaml"'},{value:'"json"'},{value:'"proto"'}]}},selectedUri:{defaultValue:null,description:"",name:"selectedUri",required:!1,type:{name:"`/${string}`"}}}}}catch{}export{O as default};
//# sourceMappingURL=MonacoDiffEditorElement-a8163756.js.map
