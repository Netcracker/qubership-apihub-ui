{"version":3,"file":"MonacoDiffEditorElement-eda55753.js","sources":["../../packages/shared/src/components/MonacoDiffEditor/useAddLineControls.tsx","../../packages/shared/src/components/MonacoDiffEditor/useMonacoDiffEditorElement.ts","../../packages/shared/src/components/MonacoDiffEditor/MonacoDiffEditorElement.tsx"],"sourcesContent":["import { editor as Editor, Range } from 'monaco-editor'\nimport type { MutableRefObject } from 'react'\nimport { useEffect, useRef } from 'react'\n\nconst RawDiffTypes = {\n  add: 'add',\n  remove: 'remove',\n  change: 'change',\n}\ntype RawDiffType = typeof RawDiffTypes[keyof typeof RawDiffTypes]\n\nexport function useAddLineControls(\n  editor: MutableRefObject<Editor.IStandaloneDiffEditor | undefined>,\n): void {\n  const widgetsRef = useRef<Editor.IGlyphMarginWidget[]>([])\n  const modelIdRef = useRef<string | null>(null)\n  const disposableRef = useRef<{ dispose: () => void } | null>(null)\n\n  useEffect(() => {\n    if (!editor.current) {\n      return\n    }\n\n    const diffEditor = editor.current\n    const modifiedEditor = diffEditor.getModifiedEditor()\n    const model = diffEditor.getModel()\n\n    if (!model) {\n      return\n    }\n\n    const currentModelId = model.modified.uri.toString()\n\n    // Only create widgets if model changed\n    if (modelIdRef.current === currentModelId) {\n      return\n    }\n\n    modelIdRef.current = currentModelId\n\n    // Cleanup previous subscription and widgets\n    if (disposableRef.current) {\n      disposableRef.current.dispose()\n    }\n\n    const currentWidgets = widgetsRef.current\n\n    currentWidgets.forEach((widget) => {\n      modifiedEditor.removeGlyphMarginWidget(widget)\n    })\n\n    widgetsRef.current = []\n\n    // Function to add line controls\n    const addLineControls = (): void => {\n      // Clean up existing widgets before adding new ones\n      widgetsRef.current.forEach((widget) => {\n        modifiedEditor.removeGlyphMarginWidget(widget)\n      })\n\n      const lineChanges = diffEditor.getLineChanges()\n\n      if (!lineChanges) {\n        return\n      }\n\n      const widgets: Editor.IGlyphMarginWidget[] = []\n\n      // Create a glyph margin widget only for lines in changed fragments\n      lineChanges.forEach((change) => {\n        // Get the range of modified lines for this change\n        const {\n          modifiedStartLineNumber,\n          modifiedEndLineNumber,\n        } = change\n\n        const diffType: RawDiffType = detectDiffType(change)\n\n        // Create a button for each line in the changed fragment\n        for (let lineNumber = modifiedStartLineNumber; lineNumber <= modifiedEndLineNumber; lineNumber++) {\n          // Create simple HTML button\n          const button = document.createElement('button')\n          button.textContent = 'â†’'\n          button.style.cssText = 'cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;'\n\n          button.onclick = (e) => {\n            e.preventDefault()\n            e.stopPropagation()\n            console.log('Reverting change:', change)\n            const originalValue = diffEditor.getModel()?.original.getValue()\n            const modifiedValue = diffEditor.getModel()?.modified.getValue()\n            if (originalValue && modifiedValue) {\n              const revertedValue = revertChange(originalValue, modifiedValue, change)\n              console.log('Spec after reverting change:', revertedValue)\n            }\n          }\n\n          let range: Range\n          if (diffType === RawDiffTypes.add) {\n            range = new Range(lineNumber, 1, modifiedEndLineNumber, 1)\n            lineNumber += modifiedEndLineNumber - lineNumber + 1\n          } else {\n            range = new Range(lineNumber, 1, lineNumber, 1)\n          }\n\n          const widget: Editor.IGlyphMarginWidget = {\n            getId: () => `line-control-${lineNumber}`,\n            getDomNode: () => button,\n            getPosition: () => ({\n              lane: Editor.GlyphMarginLane.Right,\n              zIndex: 10,\n              range: range,\n            }),\n          }\n\n          modifiedEditor.addGlyphMarginWidget(widget)\n          widgets.push(widget)\n        }\n      })\n\n      widgetsRef.current = widgets\n    }\n\n    // Try to add controls immediately\n    addLineControls()\n\n    // Subscribe to diff updates to add controls when diff is computed\n    disposableRef.current = diffEditor.onDidUpdateDiff(() => { addLineControls() })\n\n    return () => { disposableRef.current?.dispose() }\n  }, [editor])\n}\n\n/**\n * Receives original and modified values and a change and returns modified value with reverted change\n * @param originalValue Original value\n * @param modifiedValue Modified value\n * @param change MonacoEditor line change\n * @returns Modified value with reverted change\n */\nfunction revertChange(\n  originalValue: string,\n  modifiedValue: string,\n  change: Editor.ILineChange,\n): string {\n  const originalLines = originalValue.split('\\n')\n  const modifiedLines = modifiedValue.split('\\n')\n\n  const diffType: RawDiffType = detectDiffType(change)\n\n  if (diffType === RawDiffTypes.change || diffType === RawDiffTypes.remove) {\n    const pickedOriginalLines = originalLines.slice(change.originalStartLineNumber - 1, change.originalEndLineNumber)\n    const updatedModifiedLines = [...modifiedLines]\n    updatedModifiedLines.splice(change.modifiedStartLineNumber - 1, 0, ...pickedOriginalLines)\n    return updatedModifiedLines.join('\\n')\n  }\n\n  if (diffType === RawDiffTypes.add) {\n    const updatedModifiedLines = modifiedLines.filter(\n      (_, index) => index < change.modifiedStartLineNumber - 1 || index > change.modifiedEndLineNumber - 1,\n    )\n    return updatedModifiedLines.join('\\n')\n  }\n\n  return ''\n}\n\n/**\n * Detects diff type from MonacoEditor line change\n * Variants:\n * - change: The line has been changed\n * - add: The line(s) has(ve) been added\n * - remove: The line(s) has(ve) been removed\n * @param change MonacoEditor line change\n * @returns Diff type\n */\nfunction detectDiffType(change: Editor.ILineChange): RawDiffType {\n  const {\n    originalStartLineNumber,\n    originalEndLineNumber,\n    modifiedStartLineNumber,\n    modifiedEndLineNumber,\n  } = change\n\n  const modifiedRange = modifiedEndLineNumber - modifiedStartLineNumber\n  const originalRange = originalEndLineNumber - originalStartLineNumber\n  if (modifiedRange === originalRange) {\n    return RawDiffTypes.change\n  }\n  return modifiedRange > originalRange\n    ? RawDiffTypes.add\n    : RawDiffTypes.remove\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { RefObject } from 'react'\nimport { useEffect, useRef } from 'react'\nimport { editor as Editor } from 'monaco-editor'\nimport { useEffectOnce } from 'react-use'\nimport type { SpecType } from '../../utils/specs'\nimport type { LanguageType } from '../../types/languages'\nimport { LANGUAGE_TYPE_TEXT } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\nimport { findPathLocation } from '../../utils/specifications'\nimport { useAddLineControls } from './useAddLineControls'\n\nexport function useMonacoDiffEditorElement(options: {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n}): RefObject<HTMLDivElement> {\n  const { before, after, type, language = LANGUAGE_TYPE_TEXT, selectedUri } = options\n\n  const ref = useRef<HTMLDivElement>(null)\n  const editor = useRef<Editor.IStandaloneDiffEditor>()\n\n  useEffectOnce(() => {\n    Editor.defineTheme('custom', {\n      base: 'vs',\n      inherit: true,\n      rules: [],\n      colors: {\n        'editor.background': '#FFFFFF',\n      },\n    })\n\n    editor.current = Editor.createDiffEditor(ref.current!, {\n      minimap: { enabled: true },\n      hover: { above: false },\n      automaticLayout: true,\n      readOnly: true,\n      wordWrap: 'on',\n      glyphMargin: true,\n      theme: 'custom',\n    })\n\n    return () => {\n      editor.current?.dispose()\n    }\n  })\n\n  useEffect(() => {\n    //todo resolve problem with load schema model by filename (like in useSetEditorModel)\n    editor.current?.setModel({\n      original: Editor.createModel(before, language),\n      modified: Editor.createModel(after, language),\n    })\n\n    return () => {\n      editor.current?.getModel()?.original?.dispose()\n      editor.current?.getModel()?.modified?.dispose()\n    }\n  }, [editor, before, after, language, type])\n\n  useAddLineControls(editor)\n\n  useEffect(() => {\n    const content = editor.current?.getModel()?.modified.getValue()\n    if (selectedUri && content) {\n      const location = findPathLocation(content, selectedUri)\n      if (location) {\n        const startLine = location?.range.start.line\n        navigateTo(editor.current!, startLine + 1)\n      }\n    }\n  }, [selectedUri])\n\n  return ref\n}\n\nfunction navigateTo(\n  editor: Editor.IStandaloneDiffEditor,\n  lineNumber: number,\n): void {\n  editor.revealLineNearTop(lineNumber, Editor.ScrollType.Smooth)\n  editor.setPosition({ lineNumber: lineNumber, column: 0 })\n  editor.focus()\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'monaco-editor/esm/vs/editor/editor.all.js'\nimport 'monaco-editor/esm/vs/language/json/monaco.contribution'\nimport 'monaco-editor/esm/vs/basic-languages/yaml/yaml.contribution'\nimport 'monaco-editor/esm/vs/basic-languages/markdown/markdown.contribution'\n\nimport type { FC } from 'react'\nimport { memo } from 'react'\nimport { useMonacoDiffEditorElement } from './useMonacoDiffEditorElement'\nimport type { SpecType } from '../../utils/specs'\nimport type { LanguageType } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\n\nexport type MonacoDiffEditorElementProps = {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n}\n\nconst MonacoDiffEditorElement: FC<MonacoDiffEditorElementProps> = memo<MonacoDiffEditorElementProps>(({\n  before,\n  after,\n  type,\n  language,\n  selectedUri,\n}) => {\n  const element = useMonacoDiffEditorElement({ before, after, type, language, selectedUri })\n\n  return (\n    <div\n      ref={element}\n      style={{ height: '100%' }}\n    />\n  )\n})\n\nexport default MonacoDiffEditorElement\n"],"names":["RawDiffTypes","useAddLineControls","editor","widgetsRef","useRef","modelIdRef","disposableRef","useEffect","diffEditor","modifiedEditor","model","currentModelId","widget","addLineControls","lineChanges","widgets","change","modifiedStartLineNumber","modifiedEndLineNumber","diffType","detectDiffType","lineNumber","button","e","originalValue","_a","modifiedValue","_b","revertedValue","revertChange","range","Range","Editor","originalLines","modifiedLines","pickedOriginalLines","updatedModifiedLines","_","index","originalStartLineNumber","originalEndLineNumber","modifiedRange","originalRange","useMonacoDiffEditorElement","options","before","after","type","language","LANGUAGE_TYPE_TEXT","selectedUri","ref","useEffectOnce","content","location","findPathLocation","startLine","navigateTo","MonacoDiffEditorElement","memo","element","jsx"],"mappings":"4hDAIA,MAAAA,EAAA,CAAqB,IAAA,MACd,OAAA,SACG,OAAA,QAEV,EAGO,SAAAC,EAAAC,EAAA,CAGL,MAAAC,EAAAC,SAAA,CAAA,CAAA,EACAC,EAAAD,SAAA,IAAA,EACAE,EAAAF,SAAA,IAAA,EAEAG,EAAAA,UAAA,IAAA,CACE,GAAA,CAAAL,EAAA,QACE,OAGF,MAAAM,EAAAN,EAAA,QACAO,EAAAD,EAAA,oBACAE,EAAAF,EAAA,WAEA,GAAA,CAAAE,EACE,OAGF,MAAAC,EAAAD,EAAA,SAAA,IAAA,SAAA,EAGA,GAAAL,EAAA,UAAAM,EACE,OAGFN,EAAA,QAAAM,EAGAL,EAAA,SACEA,EAAA,QAAA,UAGFH,EAAA,QAEA,QAAAS,GAAA,CACEH,EAAA,wBAAAG,CAAA,CAA6C,CAAA,EAG/CT,EAAA,QAAA,GAGA,MAAAU,EAAA,IAAA,CAEEV,EAAA,QAAA,QAAAS,GAAA,CACEH,EAAA,wBAAAG,CAAA,CAA6C,CAAA,EAG/C,MAAAE,EAAAN,EAAA,iBAEA,GAAA,CAAAM,EACE,OAGF,MAAAC,EAAA,CAAA,EAGAD,EAAA,QAAAE,GAAA,CAEE,KAAA,CAAM,wBAAAC,EACJ,sBAAAC,CACA,EAAAF,EAGFG,EAAAC,EAAAJ,CAAA,EAGA,QAAAK,EAAAJ,EAAAI,GAAAH,EAAAG,IAAA,CAEE,MAAAC,EAAA,SAAA,cAAA,QAAA,EACAA,EAAA,YAAA,IACAA,EAAA,MAAA,QAAA,iHAEAA,EAAA,QAAAC,GAAA,SACEA,EAAA,eAAA,EACAA,EAAA,gBAAA,EACA,QAAA,IAAA,oBAAAP,CAAA,EACA,MAAAQ,GAAAC,EAAAjB,EAAA,SAAA,IAAA,YAAAiB,EAAA,SAAA,WACAC,GAAAC,EAAAnB,EAAA,SAAA,IAAA,YAAAmB,EAAA,SAAA,WACA,GAAAH,GAAAE,EAAA,CACE,MAAAE,EAAAC,EAAAL,EAAAE,EAAAV,CAAA,EACA,QAAA,IAAA,+BAAAY,CAAA,CAAyD,CAC3D,EAGF,IAAAE,EACAX,IAAAnB,EAAA,KACE8B,EAAA,IAAAC,EAAAV,EAAA,EAAAH,EAAA,CAAA,EACAG,GAAAH,EAAAG,EAAA,GAEAS,EAAA,IAAAC,EAAAV,EAAA,EAAAA,EAAA,CAAA,EAGF,MAAAT,EAAA,CAA0C,MAAA,IAAA,gBAAAS,CAAA,GACD,WAAA,IAAAC,EACrB,YAAA,KAAA,CACE,KAAAU,EAAA,gBAAA,MACW,OAAA,GACrB,MAAAF,CACR,EACF,EAGFrB,EAAA,qBAAAG,CAAA,EACAG,EAAA,KAAAH,CAAA,CAAmB,CACrB,CAAA,EAGFT,EAAA,QAAAY,CAAqB,EAIvB,OAAAF,IAGAP,EAAA,QAAAE,EAAA,gBAAA,IAAA,CAA2DK,GAAgB,CAAA,EAE3E,IAAA,QAAeY,EAAAnB,EAAA,UAAA,MAAAmB,EAAA,SAA+B,CAAE,EAAA,CAAAvB,CAAA,CAAA,CAEpD,CASA,SAAA2B,EAAAL,EAAAE,EAAAV,EAAA,CAKE,MAAAiB,EAAAT,EAAA,MAAA;AAAA,CAAA,EACAU,EAAAR,EAAA,MAAA;AAAA,CAAA,EAEAP,EAAAC,EAAAJ,CAAA,EAEA,GAAAG,IAAAnB,EAAA,QAAAmB,IAAAnB,EAAA,OAAA,CACE,MAAAmC,EAAAF,EAAA,MAAAjB,EAAA,wBAAA,EAAAA,EAAA,qBAAA,EACAoB,EAAA,CAAA,GAAAF,CAAA,EACA,OAAAE,EAAA,OAAApB,EAAA,wBAAA,EAAA,EAAA,GAAAmB,CAAA,EACAC,EAAA,KAAA;AAAA,CAAA,CAAqC,CAGvC,OAAAjB,IAAAnB,EAAA,IACEkC,EAAA,OAA2C,CAAAG,EAAAC,IAAAA,EAAAtB,EAAA,wBAAA,GAAAsB,EAAAtB,EAAA,sBAAA,CAC0D,EAErG,KAAA;AAAA,CAAA,EAGF,EACF,CAWA,SAAAI,EAAAJ,EAAA,CACE,KAAA,CAAM,wBAAAuB,EACJ,sBAAAC,EACA,wBAAAvB,EACA,sBAAAC,CACA,EAAAF,EAGFyB,EAAAvB,EAAAD,EACAyB,EAAAF,EAAAD,EACA,OAAAE,IAAAC,EACE1C,EAAA,OAEFyC,EAAAC,EAAA1C,EAAA,IAAAA,EAAA,MAGF,yHCrKO,SAAS2C,EAA2BC,EAMb,CAC5B,KAAM,CAAE,OAAAC,EAAQ,MAAAC,EAAO,KAAAC,EAAM,SAAAC,EAAWC,EAAoB,YAAAC,CAAgB,EAAAN,EAEtEO,EAAM/C,SAAuB,IAAI,EACjCF,EAASE,EAAAA,SAEf,OAAAgD,EAAc,KACZpB,EAAO,YAAY,SAAU,CAC3B,KAAM,KACN,QAAS,GACT,MAAO,CAAC,EACR,OAAQ,CACN,oBAAqB,SACvB,CAAA,CACD,EAED9B,EAAO,QAAU8B,EAAO,iBAAiBmB,EAAI,QAAU,CACrD,QAAS,CAAE,QAAS,EAAK,EACzB,MAAO,CAAE,MAAO,EAAM,EACtB,gBAAiB,GACjB,SAAU,GACV,SAAU,KACV,YAAa,GACb,MAAO,QAAA,CACR,EAEM,IAAM,QACXjD,EAAAA,EAAO,UAAPA,MAAAA,EAAgB,SAAQ,EAE3B,EAEDK,EAAAA,UAAU,IAAM,OAEdL,OAAAA,EAAAA,EAAO,UAAPA,MAAAA,EAAgB,SAAS,CACvB,SAAU8B,EAAO,YAAYa,EAAQG,CAAQ,EAC7C,SAAUhB,EAAO,YAAYc,EAAOE,CAAQ,CAAA,GAGvC,IAAM,kBACX9C,GAAAA,GAAAA,EAAAA,EAAO,UAAPA,YAAAA,EAAgB,aAAhBA,YAAAA,EAA4B,WAA5BA,MAAAA,EAAsC,WACtCA,GAAAA,GAAAA,EAAAA,EAAO,UAAPA,YAAAA,EAAgB,aAAhBA,YAAAA,EAA4B,WAA5BA,MAAAA,EAAsC,SAAQ,CAChD,EACC,CAACA,EAAQ2C,EAAQC,EAAOE,EAAUD,CAAI,CAAC,EAE1C9C,EAAmBC,CAAM,EAEzBK,EAAAA,UAAU,IAAM,SACd,MAAM8C,GAAUnD,GAAAA,EAAAA,EAAO,UAAPA,YAAAA,EAAgB,aAAhBA,YAAAA,EAA4B,SAAS,WACrD,GAAIgD,GAAeG,EAAS,CACpB,MAAAC,EAAWC,EAAiBF,EAASH,CAAW,EACtD,GAAII,EAAU,CACN,MAAAE,EAAYF,GAAA,YAAAA,EAAU,MAAM,MAAM,KAC7BG,EAAAvD,EAAO,QAAUsD,EAAY,CAAC,CAC3C,CACF,CAAA,EACC,CAACN,CAAW,CAAC,EAETC,CACT,CAEA,SAASM,EACPvD,EACAmB,EACM,CACNnB,EAAO,kBAAkBmB,EAAYW,EAAO,WAAW,MAAM,EAC7D9B,EAAO,YAAY,CAAE,WAAAmB,EAAwB,OAAQ,CAAG,CAAA,EACxDnB,EAAO,MAAM,CACf,CChEA,MAAAwD,EAAAC,EAAA,KAAA,CAAA,CAAsG,OAAAd,EACpG,MAAAC,EACA,KAAAC,EACA,SAAAC,EACA,YAAAE,CAEF,IAAA,CACE,MAAAU,EAAAjB,EAAA,CAAA,OAAAE,EAAA,MAAAC,EAAA,KAAAC,EAAA,SAAAC,EAAA,YAAAE,CAAA,CAAA,EAEA,OAAAW,EACE,MAAC,CAAA,IAAAD,EACM,MAAA,CAAA,OAAA,MAAA,CACmB,CAAA,CAG9B,CAAA"}