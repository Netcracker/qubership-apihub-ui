{"version":3,"file":"MonacoDiffEditorElement-d61c36aa.js","sources":["../../packages/shared/src/components/MonacoDiffEditor/useAddLineControls.tsx","../../packages/shared/src/components/MonacoDiffEditor/useMonacoDiffEditorElement.ts","../../packages/shared/src/components/MonacoDiffEditor/MonacoDiffEditorElement.tsx"],"sourcesContent":["import { editor as Editor, Range } from 'monaco-editor'\nimport type { Dispatch, MutableRefObject, SetStateAction } from 'react'\nimport { useEffect, useRef } from 'react'\nimport { useParams } from 'react-router'\nimport type { RevertChangeInAiEnhancedPackageVersionMutationFn } from '../../entities/ai-agent'\n\nconst RawDiffTypes = {\n  add: 'add',\n  remove: 'remove',\n  change: 'change',\n}\ntype RawDiffType = typeof RawDiffTypes[keyof typeof RawDiffTypes]\n\nexport function useAddLineControls(\n  editor: MutableRefObject<Editor.IStandaloneDiffEditor | undefined>,\n  setRevertedChange: Dispatch<SetStateAction<Editor.ILineChange | undefined>>,\n  setViewSnapshot?: Dispatch<SetStateAction<{ scrollTop: number; firstVisibleLine?: number } | undefined>>,\n  saveRevertChange?: RevertChangeInAiEnhancedPackageVersionMutationFn,\n): void {\n  const { packageId, versionId, documentId } = useParams()\n\n  const widgetsRef = useRef<Editor.IGlyphMarginWidget[]>([])\n  const modelIdRef = useRef<string | null>(null)\n  const disposableRef = useRef<{ dispose: () => void } | null>(null)\n\n  useEffect(() => {\n    if (!editor.current) {\n      return\n    }\n\n    const diffEditor = editor.current\n    const modifiedEditor = diffEditor.getModifiedEditor()\n    const model = diffEditor.getModel()\n\n    if (!model) {\n      return\n    }\n\n    const currentModelId = model.modified.uri.toString()\n\n    // Only create widgets if model changed\n    if (modelIdRef.current === currentModelId) {\n      return\n    }\n\n    modelIdRef.current = currentModelId\n\n    // Cleanup previous subscription and widgets\n    if (disposableRef.current) {\n      disposableRef.current.dispose()\n    }\n\n    const currentWidgets = widgetsRef.current\n\n    currentWidgets.forEach((widget) => {\n      modifiedEditor.removeGlyphMarginWidget(widget)\n    })\n\n    widgetsRef.current = []\n\n    // Function to add line controls\n    const addLineControls = (): void => {\n      // Clean up existing widgets before adding new ones\n      widgetsRef.current.forEach((widget) => {\n        modifiedEditor.removeGlyphMarginWidget(widget)\n      })\n\n      const lineChanges = diffEditor.getLineChanges()\n\n      if (!lineChanges) {\n        return\n      }\n\n      const widgets: Editor.IGlyphMarginWidget[] = []\n\n      // Create a glyph margin widget only for lines in changed fragments\n      lineChanges.forEach((change) => {\n        // Get the range of modified lines for this change\n        const {\n          modifiedStartLineNumber,\n          modifiedEndLineNumber,\n        } = change\n\n        const diffType: RawDiffType = detectDiffType(change)\n\n        // Create a button for each line in the changed fragment\n        for (let lineNumber = modifiedStartLineNumber; lineNumber <= modifiedEndLineNumber; lineNumber++) {\n          // Create simple HTML button\n          const button = document.createElement('button')\n          button.textContent = 'â†’'\n          button.style.cssText = 'cursor: pointer; border: none; background: none; font-size: 16px; padding: 0; width: 100%; text-align: center;'\n\n          button.onclick = (e) => {\n            e.preventDefault()\n            e.stopPropagation()\n            // Capture current viewport state before triggering revert\n            try {\n              const currentRanges = modifiedEditor.getVisibleRanges()\n              const firstVisibleLine = currentRanges?.[0]?.startLineNumber\n              const scrollTop = modifiedEditor.getScrollTop()\n              setViewSnapshot?.({ scrollTop, firstVisibleLine })\n            } catch (_) {\n              // ignore snapshot errors\n            }\n            const originalValue = diffEditor.getModel()?.original.getValue()\n            const modifiedValue = diffEditor.getModel()?.modified.getValue()\n            if (originalValue && modifiedValue) {\n              const valueWithRevertedChange = revertChangeLocally(originalValue, modifiedValue, change)\n              saveRevertChange?.({\n                packageId: packageId ?? '',\n                version: versionId ?? '',\n                slug: documentId ?? '',\n                content: valueWithRevertedChange,\n              })\n              setRevertedChange(change)\n            }\n          }\n\n          let range: Range\n          if (diffType === RawDiffTypes.add) {\n            range = new Range(lineNumber, 1, modifiedEndLineNumber, 1)\n            lineNumber += modifiedEndLineNumber - lineNumber + 1\n          } else {\n            range = new Range(lineNumber, 1, lineNumber, 1)\n          }\n\n          const widget: Editor.IGlyphMarginWidget = {\n            getId: () => `line-control-${lineNumber}`,\n            getDomNode: () => button,\n            getPosition: () => ({\n              lane: Editor.GlyphMarginLane.Right,\n              zIndex: 10,\n              range: range,\n            }),\n          }\n\n          modifiedEditor.addGlyphMarginWidget(widget)\n          widgets.push(widget)\n        }\n      })\n\n      widgetsRef.current = widgets\n    }\n\n    // Try to add controls immediately\n    addLineControls()\n\n    // Subscribe to diff updates to add controls when diff is computed\n    disposableRef.current = diffEditor.onDidUpdateDiff(() => { addLineControls() })\n\n    return () => { disposableRef.current?.dispose() }\n  }, [documentId, editor, packageId, saveRevertChange, setRevertedChange, setViewSnapshot, versionId])\n}\n\n/**\n * Receives original and modified values and a change and returns modified value with reverted change\n * @param originalValue Original value\n * @param modifiedValue Modified value\n * @param change MonacoEditor line change\n * @returns Modified value with reverted change\n */\nfunction revertChangeLocally(\n  originalValue: string,\n  modifiedValue: string,\n  change: Editor.ILineChange,\n): string {\n  const originalLines = originalValue.split('\\n')\n  const modifiedLines = modifiedValue.split('\\n')\n\n  const diffType: RawDiffType = detectDiffType(change)\n\n  if (diffType === RawDiffTypes.remove) {\n    const pickedOriginalLines = originalLines.slice(change.originalStartLineNumber - 1, change.originalEndLineNumber)\n    const updatedModifiedLines = [...modifiedLines]\n    updatedModifiedLines.splice(change.modifiedStartLineNumber - 1, 0, ...pickedOriginalLines)\n    return updatedModifiedLines.join('\\n')\n  }\n\n  if (diffType === RawDiffTypes.change) {\n    const pickedOriginalLines = originalLines.slice(change.originalStartLineNumber - 1, change.originalEndLineNumber)\n    const updatedModifiedLines = [...modifiedLines]\n    updatedModifiedLines.splice(change.modifiedStartLineNumber - 1, pickedOriginalLines.length, ...pickedOriginalLines)\n    return updatedModifiedLines.join('\\n')\n  }\n\n  if (diffType === RawDiffTypes.add) {\n    const updatedModifiedLines = modifiedLines.filter(\n      (_, index) => index < change.modifiedStartLineNumber - 1 || index > change.modifiedEndLineNumber - 1,\n    )\n    return updatedModifiedLines.join('\\n')\n  }\n\n  return ''\n}\n\n/**\n * Detects diff type from MonacoEditor line change\n * Variants:\n * - change: The line has been changed\n * - add: The line(s) has(ve) been added\n * - remove: The line(s) has(ve) been removed\n * @param change MonacoEditor line change\n * @returns Diff type\n */\nfunction detectDiffType(change: Editor.ILineChange): RawDiffType {\n  const {\n    originalStartLineNumber,\n    originalEndLineNumber,\n    modifiedStartLineNumber,\n    modifiedEndLineNumber,\n  } = change\n\n  const modifiedRange = modifiedEndLineNumber - modifiedStartLineNumber\n  const originalRange = originalEndLineNumber - originalStartLineNumber\n  if (modifiedRange === originalRange) {\n    return RawDiffTypes.change\n  }\n  return modifiedRange > originalRange\n    ? RawDiffTypes.add\n    : RawDiffTypes.remove\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { editor as Editor, Range } from 'monaco-editor'\nimport type { RefObject } from 'react'\nimport { useEffect, useRef, useState } from 'react'\nimport { useEffectOnce } from 'react-use'\nimport type { RevertChangeInAiEnhancedPackageVersionMutationFn } from '../../entities/ai-agent'\nimport type { LanguageType } from '../../types/languages'\nimport { LANGUAGE_TYPE_TEXT } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\nimport { findPathLocation } from '../../utils/specifications'\nimport type { SpecType } from '../../utils/specs'\nimport { useAddLineControls } from './useAddLineControls'\n\ntype EditorViewportSnapshot = {\n  scrollTop: number\n  firstVisibleLine?: number\n}\n\ntype UseMonacoDiffEditorElementOptions = {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n  requestRevertChange?: RevertChangeInAiEnhancedPackageVersionMutationFn\n}\n\nexport function useMonacoDiffEditorElement(\n  options: UseMonacoDiffEditorElementOptions,\n): RefObject<HTMLDivElement> {\n  const { before, after, type, language = LANGUAGE_TYPE_TEXT, selectedUri, requestRevertChange } = options\n\n  const ref = useRef<HTMLDivElement>(null)\n  const editor = useRef<Editor.IStandaloneDiffEditor>()\n\n  const [revertedChange, setRevertedChange] = useState<Editor.ILineChange | undefined>(undefined)\n  const [viewSnapshot, setViewSnapshot] = useState<EditorViewportSnapshot | undefined>(undefined)\n\n  useEffectOnce(() => {\n    Editor.defineTheme('custom', {\n      base: 'vs',\n      inherit: true,\n      rules: [],\n      colors: {\n        'editor.background': '#FFFFFF',\n      },\n    })\n\n    editor.current = Editor.createDiffEditor(ref.current!, {\n      minimap: { enabled: true },\n      hover: { above: false },\n      automaticLayout: true,\n      readOnly: true,\n      wordWrap: 'on',\n      glyphMargin: true,\n      theme: 'custom',\n    })\n\n    return () => {\n      try {\n        editor.current?.setModel(null)\n      } catch (_) {\n        // editor might already be disposed; ignore\n      }\n      editor.current?.dispose()\n      // prevent future calls on a disposed instance\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      editor.current = undefined\n    }\n  })\n\n  useEffect(() => {\n    //todo resolve problem with load schema model by filename (like in useSetEditorModel)\n\n    // Capture current scroll position before model swap to prevent jump to top\n    const modifiedEditor = editor.current?.getModifiedEditor()\n    const previousScrollTop = modifiedEditor?.getScrollTop() ?? 0\n\n    const originalModel = Editor.createModel(before, language)\n    const modifiedModel = Editor.createModel(after, language)\n\n    editor.current?.setModel({\n      original: originalModel,\n      modified: modifiedModel,\n    })\n\n    // Immediately restore scroll position after model swap to prevent visible jump\n    if (modifiedEditor && previousScrollTop > 0) {\n      modifiedEditor.setScrollTop(previousScrollTop, Editor.ScrollType.Immediate)\n    }\n\n    // TODO 06.11.25 // Is branch \"else\" necessary?\n    if (revertedChange) {\n      // If we have a pre-revert viewport snapshot, restore it; otherwise, navigate to the change\n      if (viewSnapshot) {\n        restoreView(editor.current!, viewSnapshot)\n      } else {\n        const startLine = revertedChange.modifiedStartLineNumber\n        startLine !== undefined && navigateTo(editor.current!, startLine)\n      }\n    }\n\n    return () => {\n      const { current } = editor\n      const currentModel = current?.getModel()\n\n      // Detach only if the editor still uses the models created by this render\n      if (\n        current &&\n        currentModel &&\n        currentModel.original === originalModel &&\n        currentModel.modified === modifiedModel\n      ) {\n        try {\n          current.setModel(null)\n        } catch (_) {\n          // editor may have been disposed concurrently; ignore\n        }\n      }\n\n      originalModel.dispose()\n      modifiedModel.dispose()\n    }\n  }, [editor, before, after, language, type, revertedChange, viewSnapshot])\n\n  useAddLineControls(editor, setRevertedChange, setViewSnapshot, requestRevertChange)\n\n  useEffect(() => {\n    const content = editor.current?.getModel()?.modified.getValue()\n    if (content && selectedUri) {\n      const location = findPathLocation(content, selectedUri)\n      const startLine = location?.range.start.line\n      startLine !== undefined && navigateTo(editor.current!, startLine + 1)\n    }\n  }, [selectedUri])\n\n  return ref\n}\n\nfunction navigateTo(\n  editor: Editor.IStandaloneDiffEditor,\n  lineNumber: number,\n): void {\n  const modifiedEditor = editor.getModifiedEditor()\n\n  // Keep navigation resilient during a short stabilization window\n  const stabilizeMs = 300\n  const endTime = Date.now() + stabilizeMs\n  let lastApply = 0\n  const applyIntervalMs = 30\n  const applyNavigate = (): void => {\n    const now = Date.now()\n    if (now - lastApply < applyIntervalMs) return\n    lastApply = now\n    const targetRange = new Range(lineNumber, 1, lineNumber, 1)\n    modifiedEditor.revealRangeNearTop(targetRange, Editor.ScrollType.Smooth)\n    modifiedEditor.setSelection(targetRange)\n    modifiedEditor.focus()\n  }\n\n  // Try immediately if models are ready\n  const model = modifiedEditor.getModel()\n  if (model) {\n    // Schedule to the next frame to wait for layout after model swap\n    requestAnimationFrame(() => {\n      applyNavigate()\n    })\n  }\n\n  // Also listen for diff update/layout as a robust fallback (fires after model attach/layout)\n  const disposables: { dispose: () => void }[] = []\n  const disposeAll = (): void => {\n    disposables.forEach(d => {\n      try {\n        d.dispose()\n      } catch (_) {\n        // ignore\n      }\n    })\n  }\n\n  disposables.push(\n    editor.onDidUpdateDiff(() => {\n      applyNavigate()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  disposables.push(\n    modifiedEditor.onDidLayoutChange(() => {\n      applyNavigate()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  // Also react to unexpected scroll resets during stabilization\n  disposables.push(\n    modifiedEditor.onDidScrollChange(() => {\n      applyNavigate()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  // Final timer-based fallback in case neither event fires (e.g., no diff)\n  setTimeout(() => {\n    applyNavigate()\n    if (Date.now() > endTime) disposeAll()\n  }, 50)\n\n  // Robustness: retry a few times until the line is actually visible\n  let attemptsRemaining = 3\n  const tryEnsureVisible = (): void => {\n    const ranges = modifiedEditor.getVisibleRanges()\n    const isVisible = ranges.some(r => r.startLineNumber <= lineNumber && r.endLineNumber >= lineNumber)\n    const scrolled = modifiedEditor.getScrollTop() > 0 || lineNumber === 1\n    if (isVisible || scrolled || attemptsRemaining <= 0) return\n    attemptsRemaining -= 1\n    setTimeout(() => {\n      const targetRange = new Range(lineNumber, 1, lineNumber, 1)\n      modifiedEditor.revealRangeNearTop(targetRange, Editor.ScrollType.Smooth)\n      requestAnimationFrame(tryEnsureVisible)\n    }, 60)\n  }\n  requestAnimationFrame(tryEnsureVisible)\n}\n\nfunction restoreView(\n  editor: Editor.IStandaloneDiffEditor,\n  snapshot: { scrollTop: number; firstVisibleLine?: number },\n): void {\n  const modifiedEditor = editor.getModifiedEditor()\n\n  const stabilizeMs = 300\n  const endTime = Date.now() + stabilizeMs\n  let lastApply = 0\n  const applyIntervalMs = 30\n\n  const applyRestore = (): void => {\n    const now = Date.now()\n    if (now - lastApply < applyIntervalMs) return\n    lastApply = now\n    // Directly restore the exact scroll position\n    modifiedEditor.setScrollTop(snapshot.scrollTop, Editor.ScrollType.Immediate)\n  }\n\n  const disposables: { dispose: () => void }[] = []\n  const disposeAll = (): void => {\n    disposables.forEach(d => {\n      try {\n        d.dispose()\n      } catch (_) {\n        // ignore\n      }\n    })\n  }\n\n  requestAnimationFrame(applyRestore)\n\n  disposables.push(\n    editor.onDidUpdateDiff(() => {\n      applyRestore()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n  disposables.push(\n    modifiedEditor.onDidLayoutChange(() => {\n      applyRestore()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n  disposables.push(\n    modifiedEditor.onDidScrollChange(() => {\n      // Keep the previous viewport during stabilization\n      applyRestore()\n      if (Date.now() > endTime) disposeAll()\n    }),\n  )\n\n  setTimeout(() => {\n    applyRestore()\n    if (Date.now() > endTime) disposeAll()\n  }, 50)\n}\n","/**\n * Copyright 2024-2025 NetCracker Technology Corporation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'monaco-editor/esm/vs/basic-languages/markdown/markdown.contribution'\nimport 'monaco-editor/esm/vs/basic-languages/yaml/yaml.contribution'\nimport 'monaco-editor/esm/vs/editor/editor.all.js'\nimport 'monaco-editor/esm/vs/language/json/monaco.contribution'\n\nimport type { FC } from 'react'\nimport { memo } from 'react'\nimport type { RevertChangeInAiEnhancedPackageVersionMutationFn } from '../../entities/ai-agent'\nimport type { LanguageType } from '../../types/languages'\nimport type { SpecItemUri } from '../../utils/specifications'\nimport type { SpecType } from '../../utils/specs'\nimport { useMonacoDiffEditorElement } from './useMonacoDiffEditorElement'\n\nexport type MonacoDiffEditorElementProps = {\n  before: string\n  after: string\n  type: SpecType\n  language?: LanguageType\n  selectedUri?: SpecItemUri\n  // Only for tab \"AI Agent\"\n  requestRevertChange?: RevertChangeInAiEnhancedPackageVersionMutationFn\n}\n\nconst MonacoDiffEditorElement: FC<MonacoDiffEditorElementProps> = memo<MonacoDiffEditorElementProps>(props => {\n  const {\n    before,\n    after,\n    type,\n    language,\n    selectedUri,\n    requestRevertChange,\n  } = props\n\n  const element = useMonacoDiffEditorElement({ \n    before, \n    after, \n    type, \n    language, \n    selectedUri,\n    requestRevertChange,\n  }) \n\n  return (\n    <div\n      ref={element}\n      style={{ height: '100%' }}\n    />\n  )\n})\n\nexport default MonacoDiffEditorElement\n"],"names":["RawDiffTypes","useAddLineControls","editor","setRevertedChange","setViewSnapshot","saveRevertChange","packageId","versionId","documentId","useParams","widgetsRef","useRef","modelIdRef","disposableRef","useEffect","diffEditor","modifiedEditor","model","currentModelId","widget","addLineControls","lineChanges","widgets","change","modifiedStartLineNumber","modifiedEndLineNumber","diffType","detectDiffType","lineNumber","button","e","currentRanges","firstVisibleLine","_a","scrollTop","originalValue","_b","modifiedValue","_c","valueWithRevertedChange","revertChangeLocally","range","Range","Editor","originalLines","modifiedLines","pickedOriginalLines","updatedModifiedLines","_","index","originalStartLineNumber","originalEndLineNumber","modifiedRange","originalRange","useMonacoDiffEditorElement","options","before","after","type","language","LANGUAGE_TYPE_TEXT","selectedUri","requestRevertChange","ref","revertedChange","useState","viewSnapshot","useEffectOnce","previousScrollTop","originalModel","modifiedModel","restoreView","startLine","navigateTo","current","currentModel","content","location","findPathLocation","stabilizeMs","endTime","lastApply","applyIntervalMs","applyNavigate","now","targetRange","disposables","disposeAll","d","attemptsRemaining","tryEnsureVisible","isVisible","r","scrolled","snapshot","applyRestore","MonacoDiffEditorElement","memo","props","element","jsx"],"mappings":"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"}