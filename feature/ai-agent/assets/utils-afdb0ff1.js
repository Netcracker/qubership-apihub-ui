var b=Object.defineProperty;var O=(t,e,n)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var y=(t,e,n)=>(O(t,typeof e!="symbol"?e+"":e,n),n);import{S as N,b as U,c as k,d as D}from"./constants-e3f42350.js";import{m as F}from"./router-3bda5a86.js";import{s as $}from"./index-2374ef69.js";import{r as E}from"./index-37ba2b57.js";class L extends Error{constructor(n,r,i){super(n);y(this,"code");y(this,"status");this.name="HttpError",this.code=r,this.status=i}}const x={INTERNAL:"internal",EXTERNAL:"external"};function K(t){return t.type===x.INTERNAL}const ut="package";function h(t){const e=new URLSearchParams;return Object.entries(t).forEach(([n,{value:r,toStringValue:i}])=>{if(Array.isArray(r)){const[s]=r;if(!s)return}(r||r===0)&&e.set(n,(i==null?void 0:i(r))??`${r}`)}),e}function q(){g("/login",h({[N]:{value:!0},redirectUri:{value:location.href}}))}function g(t,e=new URLSearchParams){const n=e.get("redirectUri")??location.href;e.set("redirectUri",n);let r=location.origin;t.includes("?")?r=`${r}${t}&${e}`:r=`${r}${t}?${e}`,window.stop(),location.replace(r)}function ft(t,e){const n=new URL(t.url),r=F(`${V}${e}`,n.pathname);return r&&r.params.packageId?{redirectType:Z,id:r.params.packageId}:null}function R(){const e=new URL(location.href).searchParams.get(U);return e||(location.pathname==="/login"?location.origin:location.href)}async function H(t="Thread is stopped"){await v(0,t)}async function v(t=0,e="Thread is paused"){await new Promise(n=>{console.log(e),t>0&&setTimeout(()=>{n(void 0)},t)})}const Q="/api/v3",d={NO_PROVIDER:"no-provider",NO_ENDPOINT:"no-endpoint",TOKEN_REFRESHED:"token-refreshed",UNKNOWN:"unknown"};function p(t){return t===d.TOKEN_REFRESHED}function G(t){return typeof WorkerGlobalScope<"u"&&t instanceof WorkerGlobalScope}async function M(t){const n=!new URLSearchParams(location.search).get(N);let r;if(t===401&&n){let i,s;G(self)&&({systemConfigurationDto:s,lastIdentityProviderId:i}=self),s=s||JSON.parse(sessionStorage.getItem(k));const{authConfig:c}=s,{autoLogin:u}=c;if(u){const[a]=c.identityProviders;if(r=await m(a),p(r))return r}else{i=i||localStorage.getItem(D);const a=i?c.identityProviders.find(f=>f.id===i):void 0;if(r=await m(a),p(r))return r}r===d.NO_PROVIDER&&q()}return r}async function m(t){if(!t)return d.NO_PROVIDER;let e="";if(K(t)){const r=h({noAutoLogin:{value:!0},redirectUri:{value:R()}}),i=h({redirectUri:{value:`${location.origin}/login?${r}`}});e=`${Q}/auth/local/refresh?${i}`}else if(t.loginStartEndpoint){const r=h({redirectUri:{value:R()}});e=`${t.loginStartEndpoint}?${r}`}else return d.NO_ENDPOINT;const n=await fetch(e,{method:"GET",redirect:"manual"});if(n.ok)return d.TOKEN_REFRESHED;if(n.type==="opaqueredirect"){const r=n.url.replace(location.origin,"");g(r),await H("Waiting for redirection...")}return console.error("Can't refresh token. Response:",n),d.UNKNOWN}const lt="/api/v1",dt="/api/v3",V="/api/:apiVersion",ht=5*(60*1e3);async function W(t,e,n={},r){const{basePath:i="",customErrorHandler:s,customRedirectHandler:c,ignoreNotFound:u=!1}=n,a=await fetch(`${i}${t}`,{...e,signal:r,credentials:"include"});if(!a.ok){const f=await M(a.status);return p(f)?W(t,e,n,r):(await j(a,{401:!0,404:u},s),null)}return await Y(a,c),await a.json()}async function j(t,e,n){if(e[t.status])return Promise.reject();n?n(t):await C(t)}async function Y(t,e){if(t.redirected&&e){const n=e(t);n?await z(n):await C(t)}}async function C(t){const[e,n,r]=await B(t),i={title:`Error ${t.status}`,message:e,code:n,status:r};throw dispatchEvent(new CustomEvent(J,{detail:i,bubbles:!0,composed:!0,cancelable:!1})),new L(e,n,r)}async function z(t){dispatchEvent(new CustomEvent(X,{detail:t,bubbles:!0,composed:!0,cancelable:!1})),window.stop()}async function B(t){const e=await t.json(),n=(e==null?void 0:e.message)??"Something went wrong",r=(e==null?void 0:e.code)??"",i=(e==null?void 0:e.status)??null;return e!=null&&e.params?[Object.entries(e.params).reduce((s,[c,u])=>s.replace(`$${c}`,u),n),r,i]:[n,r,i]}const J="fetch-error",X="fetch-redirect",Z="package-redirect";class Et{constructor(){this.listeners=[],this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.push(e),this.onSubscribe(),()=>{this.listeners=this.listeners.filter(n=>n!==e),this.onUnsubscribe()}}hasListeners(){return this.listeners.length>0}onSubscribe(){}onUnsubscribe(){}}const yt=typeof window>"u"||"Deno"in window;function pt(){}function Rt(t){return typeof t=="number"&&t>=0&&t!==1/0}function mt(t,e){return Math.max(t+(e||0)-Date.now(),0)}function wt(t,e,n){return I(t)?typeof e=="function"?{...n,queryKey:t,queryFn:e}:{...e,queryKey:t}:t}function Pt(t,e,n){return I(t)?typeof e=="function"?{...n,mutationKey:t,mutationFn:e}:{...e,mutationKey:t}:typeof t=="function"?{...e,mutationFn:t}:{...t}}function _(t,e){if(t===e)return t;const n=w(t)&&w(e);if(n||P(t)&&P(e)){const r=n?t.length:Object.keys(t).length,i=n?e:Object.keys(e),s=i.length,c=n?[]:{};let u=0;for(let a=0;a<s;a++){const f=n?a:i[a];c[f]=_(t[f],e[f]),c[f]===t[f]&&u++}return r===s&&u===r?t:c}return e}function St(t,e){if(t&&!e||e&&!t)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function w(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function P(t){if(!S(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const n=e.prototype;return!(!S(n)||!n.hasOwnProperty("isPrototypeOf"))}function S(t){return Object.prototype.toString.call(t)==="[object Object]"}function I(t){return Array.isArray(t)}function tt(t){return new Promise(e=>{setTimeout(e,t)})}function T(t){tt(0).then(t)}function Tt(t,e,n){return n.isDataEqual!=null&&n.isDataEqual(t,e)?t:typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?_(t,e):e}function et(){let t=[],e=0,n=o=>{o()},r=o=>{o()};const i=o=>{let l;e++;try{l=o()}finally{e--,e||u()}return l},s=o=>{e?t.push(o):T(()=>{n(o)})},c=o=>(...l)=>{s(()=>{o(...l)})},u=()=>{const o=t;t=[],o.length&&T(()=>{r(()=>{o.forEach(l=>{n(l)})})})};return{batch:i,batchCalls:c,schedule:s,setNotifyFunction:o=>{n=o},setBatchNotifyFunction:o=>{r=o}}}const At=et(),Nt=$.useSyncExternalStore,A=E.createContext(void 0),nt=E.createContext(!1);function rt(t,e){return t||(e&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=A),window.ReactQueryClientContext):A)}const gt=({context:t}={})=>{const e=E.useContext(rt(t,E.useContext(nt)));if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e};function Ct(t,e){return typeof t=="function"?t(...e):!!t}export{lt as A,ht as D,ut as P,Et as S,Nt as a,Ct as b,pt as c,Rt as d,Tt as e,wt as f,ft as g,dt as h,yt as i,At as n,h as o,Pt as p,W as r,St as s,mt as t,gt as u};
//# sourceMappingURL=utils-afdb0ff1.js.map
