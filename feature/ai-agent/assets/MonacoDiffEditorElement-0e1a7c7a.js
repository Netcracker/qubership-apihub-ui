import{j as O}from"./createTheme-d4c6d141.js";import{R as S,e as M}from"./toggleHighContrast-f8bd58a2.js";import{r as L}from"./index-37ba2b57.js";import{f as z,L as H}from"./graphql-samples-79dbe107.js";import{e as $}from"./index-6b7f7c95.js";import{u as B}from"./useEffectOnce-12abbac4.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-9c75dc50.js";import"./iframe-4718eeef.js";import"../sb-preview/runtime.js";import"./_commonjsHelpers-de833af9.js";import"./files-221a97f0.js";import"./apihub-builder.es-a0fb97bd.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./strings-8f296fda.js";import"./dialogTitleClasses-c8d9dbc5.js";import"./clsx.m-6cf3b989.js";import"./ClassNameGenerator-bd600f10.js";import"./useThemeProps-90078124.js";import"./useTheme-0ad13214.js";import"./Modal-9f2c2b11.js";import"./utils-0c060528.js";import"./inheritsLoose-5494d9cc.js";import"./index-4da2af8c.js";import"./TransitionGroupContext-f40e0036.js";import"./useEnhancedEffect-9d60ea74.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-03d1c82d.js";import"./createChainedFunction-0bab83cf.js";import"./Portal-fc00eb8c.js";import"./isHostComponent-73d6e646.js";import"./Paper-dca8f967.js";import"./useId-f6e37502.js";import"./DialogTitle-cd1b99ce.js";import"./Typography-d1555f73.js";import"./extendSxProp-acc1143e.js";import"./DialogContent-fd001b96.js";import"./DialogContentText-f02e7458.js";import"./Button-7fbb2719.js";import"./ButtonBase-1b5192e9.js";import"./emotion-react.browser.esm-f969ea94.js";import"./assertThisInitialized-081f9914.js";import"./createSvgIcon-473ccb66.js";import"./router-3bda5a86.js";const C={add:"add",remove:"remove",change:"change"};function X(l,n,e,c){const{packageId:o,versionId:r,documentId:s}=$(),t=L.useRef([]),i=L.useRef(null),u=L.useRef(null);L.useEffect(()=>{if(!l.current)return;const d=l.current,g=d.getModifiedEditor(),D=d.getOriginalEditor(),a=d.getModel();if(!a)return;const p=a.modified.uri.toString();if(i.current===p)return;i.current=p,u.current&&u.current.dispose(),t.current.forEach(y=>{try{g.removeGlyphMarginWidget(y)}catch{}try{D.removeGlyphMarginWidget(y)}catch{}}),t.current=[];const f=()=>{t.current.forEach(m=>{try{g.removeGlyphMarginWidget(m)}catch{}try{D.removeGlyphMarginWidget(m)}catch{}});const y=d.getLineChanges();if(!y)return;const E=[];y.forEach(m=>{const{originalStartLineNumber:T,originalEndLineNumber:q,modifiedStartLineNumber:R,modifiedEndLineNumber:V}=m,_=j(m),I=()=>{const h=document.createElement("button");return h.innerHTML='<svg viewBox="0 0 14 14" width="14" height="14" style="margin: 0 4px;"><path d="M4.37934 0.21934C4.51979 0.359965 4.59868 0.550589 4.59868 0.74934C4.59868 0.948091 4.51979 1.13871 4.37934 1.27934L2.55934 3.09934H7.79934C8.51504 3.09934 9.22374 3.24031 9.88496 3.5142C10.5462 3.78808 11.147 4.18953 11.6531 4.69561C12.1592 5.20169 12.5606 5.80249 12.8345 6.46372C13.1084 7.12494 13.2493 7.83364 13.2493 8.54934C13.2493 9.26504 13.1084 9.97374 12.8345 10.635C12.5606 11.2962 12.1592 11.897 11.6531 12.4031C11.147 12.9092 10.5462 13.3106 9.88496 13.5845C9.22374 13.8584 8.51504 13.9993 7.79934 13.9993H3.14934C2.95043 13.9993 2.75966 13.9203 2.61901 13.7797C2.47836 13.639 2.39934 13.4483 2.39934 13.2493C2.39934 13.0504 2.47836 12.8597 2.61901 12.719C2.75966 12.5784 2.95043 12.4993 3.14934 12.4993H7.79934C8.84695 12.4993 9.85164 12.0832 10.5924 11.3424C11.3332 10.6016 11.7493 9.59695 11.7493 8.54934C11.7493 7.50174 11.3332 6.49704 10.5924 5.75627C9.85164 5.0155 8.84695 4.59934 7.79934 4.59934H2.55934L4.37934 6.41934C4.51182 6.56151 4.58394 6.74956 4.58051 6.94386C4.57709 7.13816 4.49837 7.32355 4.36096 7.46096C4.22355 7.59838 4.03816 7.67709 3.84386 7.68052C3.64956 7.68394 3.46152 7.61182 3.31934 7.47934L0.21934 4.37934C0.0788896 4.23871 0 4.04809 0 3.84934C0 3.65059 0.0788896 3.45997 0.21934 3.31934L3.31934 0.21934C3.45997 0.0788896 3.65059 0 3.84934 0C4.04809 0 4.23871 0.0788896 4.37934 0.21934Z"/></svg>',h.style.cssText="cursor: pointer; border: none; background: none; padding: 0; width: 100%; text-align: center; display: flex; align-items: center; justify-content: center;",h.onclick=N=>{var x,A,G;N.preventDefault(),N.stopPropagation();try{const w=g.getVisibleRanges(),P=(x=w==null?void 0:w[0])==null?void 0:x.startLineNumber,U=g.getScrollTop();e==null||e({scrollTop:U,firstVisibleLine:P})}catch{}const v=(A=d.getModel())==null?void 0:A.original.getValue(),k=(G=d.getModel())==null?void 0:G.modified.getValue();if(v&&k){const w=Y(v,k,m);c==null||c({packageId:o??"",version:r??"",slug:s??"",content:w}),n(m)}},h};if(_===C.remove){const h=T,N=new S(h,1,h,1),v={getId:()=>`line-control-remove-${T}-${q}`,getDomNode:I,getPosition:()=>({lane:M.GlyphMarginLane.Right,zIndex:10,range:N})};D.addGlyphMarginWidget(v),E.push(v)}else if(_===C.add){const h=R,N=new S(h,1,h,1),v={getId:()=>`line-control-add-${R}-${V}`,getDomNode:I,getPosition:()=>({lane:M.GlyphMarginLane.Right,zIndex:10,range:N})};g.addGlyphMarginWidget(v),E.push(v)}else if(_===C.change){const h=R,N=new S(h,1,h,1),v={getId:()=>`line-control-change-${R}-${V}`,getDomNode:I,getPosition:()=>({lane:M.GlyphMarginLane.Right,zIndex:10,range:N})};g.addGlyphMarginWidget(v),E.push(v)}}),t.current=E};return f(),u.current=d.onDidUpdateDiff(()=>{f()}),()=>{var y;(y=u.current)==null||y.dispose()}},[s,l,o,c,n,e,r])}function Y(l,n,e){const c=l.split(`
`),o=n.split(`
`),r=j(e);if(r===C.add){const s=[...o],t=e.modifiedEndLineNumber-e.modifiedStartLineNumber+1;return s.splice(e.modifiedStartLineNumber-1,t),s.join(`
`)}if(r===C.remove){const s=c.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),t=[...o];return t.splice(e.originalStartLineNumber-1,0,...s),t.join(`
`)}if(r===C.change){const s=c.slice(e.originalStartLineNumber-1,e.originalEndLineNumber),t=[...o],i=e.modifiedEndLineNumber-e.modifiedStartLineNumber+1;return t.splice(e.modifiedStartLineNumber-1,i,...s),t.join(`
`)}return""}function j(l){const{originalStartLineNumber:n,originalEndLineNumber:e,modifiedStartLineNumber:c,modifiedEndLineNumber:o}=l,r=e>=n&&n>0,s=o>=c&&c>0;return r?s?C.change:C.remove:C.add}function Z(l){const{before:n,after:e,type:c,language:o=H,selectedUri:r,requestRevertChange:s}=l,t=L.useRef(null),i=L.useRef(),[u,d]=L.useState(void 0),[g,D]=L.useState(void 0);return B(()=>(M.defineTheme("custom",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#FFFFFF"}}),i.current=M.createDiffEditor(t.current,{minimap:{enabled:!0},hover:{above:!1},automaticLayout:!0,readOnly:!0,wordWrap:"on",glyphMargin:!0,theme:"custom",stickyScroll:{enabled:!1}}),()=>{var a,p;try{(a=i.current)==null||a.setModel(null)}catch{}(p=i.current)==null||p.dispose(),i.current=void 0})),L.useEffect(()=>{var y,E;const a=(y=i.current)==null?void 0:y.getModifiedEditor(),p=(a==null?void 0:a.getScrollTop())??0,b=M.createModel(n,o),f=M.createModel(e,o);if((E=i.current)==null||E.setModel({original:b,modified:f}),a&&p>0&&a.setScrollTop(p,M.ScrollType.Immediate),u)if(g)J(i.current,g);else{const m=u.modifiedStartLineNumber;m!==void 0&&F(i.current,m)}return()=>{const{current:m}=i,T=m==null?void 0:m.getModel();if(m&&T&&T.original===b&&T.modified===f)try{m.setModel(null)}catch{}b.dispose(),f.dispose()}},[i,n,e,o,c,u,g]),X(i,d,D,s),L.useEffect(()=>{var p,b;const a=(b=(p=i.current)==null?void 0:p.getModel())==null?void 0:b.modified.getValue();if(a&&r){const f=z(a,r),y=f==null?void 0:f.range.start.line;y!==void 0&&F(i.current,y+1)}},[r]),t}function F(l,n){const e=l.getModifiedEditor(),c=300,o=Date.now()+c;let r=0;const s=30,t=()=>{const a=Date.now();if(a-r<s)return;r=a;const p=new S(n,1,n,1);e.revealRangeNearTop(p,M.ScrollType.Smooth),e.setSelection(p),e.focus()};e.getModel()&&requestAnimationFrame(()=>{t()});const u=[],d=()=>{u.forEach(a=>{try{a.dispose()}catch{}})};u.push(l.onDidUpdateDiff(()=>{t(),Date.now()>o&&d()})),u.push(e.onDidLayoutChange(()=>{t(),Date.now()>o&&d()})),u.push(e.onDidScrollChange(()=>{t(),Date.now()>o&&d()})),setTimeout(()=>{t(),Date.now()>o&&d()},50);let g=3;const D=()=>{const p=e.getVisibleRanges().some(f=>f.startLineNumber<=n&&f.endLineNumber>=n),b=e.getScrollTop()>0||n===1;p||b||g<=0||(g-=1,setTimeout(()=>{const f=new S(n,1,n,1);e.revealRangeNearTop(f,M.ScrollType.Smooth),requestAnimationFrame(D)},60))};requestAnimationFrame(D)}function J(l,n){const e=l.getModifiedEditor(),c=300,o=Date.now()+c;let r=0;const s=30,t=()=>{const d=Date.now();d-r<s||(r=d,e.setScrollTop(n.scrollTop,M.ScrollType.Immediate))},i=[],u=()=>{i.forEach(d=>{try{d.dispose()}catch{}})};requestAnimationFrame(t),i.push(l.onDidUpdateDiff(()=>{t(),Date.now()>o&&u()})),i.push(e.onDidLayoutChange(()=>{t(),Date.now()>o&&u()})),i.push(e.onDidScrollChange(()=>{t(),Date.now()>o&&u()})),setTimeout(()=>{t(),Date.now()>o&&u()},50)}const W=L.memo(l=>{const{before:n,after:e,type:c,language:o,selectedUri:r,requestRevertChange:s}=l,t=Z({before:n,after:e,type:c,language:o,selectedUri:r,requestRevertChange:s});return O("div",{ref:t,style:{height:"100%"}})});try{W.displayName="MonacoDiffEditorElement",W.__docgenInfo={description:"",displayName:"MonacoDiffEditorElement",props:{before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"string"}},after:{defaultValue:null,description:"",name:"after",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"graphql"'},{value:'"openapi-3-1"'},{value:'"openapi-3-0"'},{value:'"openapi-2-0"'},{value:'"openapi"'},{value:'"asyncapi-2"'},{value:'"json-schema"'},{value:'"markdown"'},{value:'"unknown"'},{value:'"graphql-schema"'},{value:'"graphapi"'},{value:'"introspection"'},{value:'"protobuf-3"'}]}},language:{defaultValue:null,description:"",name:"language",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"graphql"'},{value:'"markdown"'},{value:'"yaml"'},{value:'"json"'},{value:'"proto"'}]}},selectedUri:{defaultValue:null,description:"",name:"selectedUri",required:!1,type:{name:"`/${string}`"}},requestRevertChange:{defaultValue:null,description:"",name:"requestRevertChange",required:!1,type:{name:"RevertChangeInAiEnhancedPackageVersionMutationFn"}}}}}catch{}export{W as default};
//# sourceMappingURL=MonacoDiffEditorElement-0e1a7c7a.js.map
